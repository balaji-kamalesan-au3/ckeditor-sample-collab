/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x114896,_0x44ee5c,_0x11b875,_0x5c3f87){void 0x0===_0x5c3f87&&(_0x5c3f87=_0x11b875),Object['defineProperty'](_0x114896,_0x5c3f87,{'enumerable':!0x0,'get':function(){return _0x44ee5c[_0x11b875];}});}:function(_0x343765,_0x5a8f16,_0xce6bc1,_0x460665){void 0x0===_0x460665&&(_0x460665=_0xce6bc1),_0x343765[_0x460665]=_0x5a8f16[_0xce6bc1];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x5d1039,_0x61f026){Object['defineProperty'](_0x5d1039,'default',{'enumerable':!0x0,'value':_0x61f026});}:function(_0x564873,_0x2a8f31){_0x564873['default']=_0x2a8f31;}),__importStar=this&&this['__importStar']||function(_0x14c289){if(_0x14c289&&_0x14c289['__esModule'])return _0x14c289;var _0x586583={};if(null!=_0x14c289)for(var _0x2bf175 in _0x14c289)'default'!==_0x2bf175&&Object['prototype']['hasOwnProperty']['call'](_0x14c289,_0x2bf175)&&__createBinding(_0x586583,_0x14c289,_0x2bf175);return __setModuleDefault(_0x586583,_0x14c289),_0x586583;},__importDefault=this&&this['__importDefault']||function(_0x44922c){return _0x44922c&&_0x44922c['__esModule']?_0x44922c:{'default':_0x44922c};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),revisionhistorygetrevisionmessage_1=__importDefault(require('./messages/revisionhistorygetrevisionmessage')),revisionhistorygetrevisionresponse_1=__importDefault(require('./responses/revisionhistorygetrevisionresponse')),revisionhistoryupdaterevisionsmessage_1=__importDefault(require('./messages/revisionhistoryupdaterevisionsmessage')),revisionhistoryupdaterevisionsresponse_1=__importDefault(require('./responses/revisionhistoryupdaterevisionsresponse')),revisionhistoryconnectmessage_1=__importDefault(require('./messages/revisionhistoryconnectmessage')),revisionhistoryconnectresponse_1=__importDefault(require('./responses/revisionhistoryconnectresponse')),revisionhistoryreconnectmessage_1=__importDefault(require('./messages/revisionhistoryreconnectmessage')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0xc;class RevisionHistoryService{constructor(_0x2b1301){this['_documentId']=_0x2b1301,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x15ec5e){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x15ec5e,new revisionhistoryconnectmessage_1['default'](this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x1f0b28,_0x12581a){if(this['isConnected'])throw new ckeditorcloudserviceserror_1['default']('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x1f0b28);return this['_connect'](_0x1f0b28,new revisionhistoryreconnectmessage_1['default'](this['_documentId'],_0x12581a));}async['updateRevisions'](_0xd07f9,_0x279340){const _0x5f1cdc=revisionhistoryupdaterevisionsmessage_1['default']['create']({'documentId':this['_documentId'],'requestId':_0x279340,'revisions':_0xd07f9}),_0x268d4f=await this['_sendRequest'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE'],_0x5f1cdc),{requestId:requestId}=messagescompressor_1['default']['decode'](_0x268d4f,revisionhistoryupdaterevisionsresponse_1['default']);return requestId;}async['getRevision'](_0x1a97b3){const _0xb4ef3f=new revisionhistorygetrevisionmessage_1['default'](this['_documentId'],_0x1a97b3),_0x5a3483=await this['_sendRequest'](revisionhistorygetrevisionmessage_1['default']['TYPE'],_0xb4ef3f);return messagescompressor_1['default']['decode'](_0x5a3483,revisionhistorygetrevisionresponse_1['default'])['toObject']();}async['_connect'](_0x2d59d6,_0x19a3ea){if(_0x2d59d6['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x2d59d6);this['_wsGateway']=_0x2d59d6,this['stopListening'](_0x2d59d6,'change:state');const _0x4befea=await _0x2d59d6['_sendRequest'](exports['_SERVICE'],_0x19a3ea['constructor']['TYPE'],messagescompressor_1['default']['encode'](_0x19a3ea)),{channel:channel,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x4befea,revisionhistoryconnectresponse_1['default'])['toObject']();return this['listenTo'](_0x2d59d6,'change:state',(_0x5d869c,_0xf6929a,_0x395ed0)=>this['_onWsGatewayStateChange'](_0x395ed0),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x2d59d6,channel),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':revisions,'requestId':requestId};}['_connectToChannel'](_0x1981bc,_0x76da76){this['_channel']=_0x1981bc['_getChannel'](RevisionHistoryService['_SERVICE'],_0x76da76),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE']),(_0x2208f5,_0x104f05)=>{const {documentId:documentId,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x104f05,revisionhistoryupdaterevisionsmessage_1['default'])['toObject']();this['fire']('revisionsUpdated',{'documentId':documentId,'requestId':requestId,'revisionsData':revisions});});}['_onWsGatewayStateChange'](_0x4f927d){_0x4f927d===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x2eb0b3,_0x504d03){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x2eb0b3,messagescompressor_1['default']['encode'](_0x504d03));}}RevisionHistoryService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(RevisionHistoryService,utils_1['EmitterMixin']),exports['default']=RevisionHistoryService;