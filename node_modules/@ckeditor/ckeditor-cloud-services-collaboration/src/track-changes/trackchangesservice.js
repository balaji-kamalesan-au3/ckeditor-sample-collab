/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x234d86,_0x51bc32,_0x2257b8,_0x409f22){void 0x0===_0x409f22&&(_0x409f22=_0x2257b8),Object['defineProperty'](_0x234d86,_0x409f22,{'enumerable':!0x0,'get':function(){return _0x51bc32[_0x2257b8];}});}:function(_0x1dba51,_0x58ce8d,_0x166b3b,_0x454af4){void 0x0===_0x454af4&&(_0x454af4=_0x166b3b),_0x1dba51[_0x454af4]=_0x58ce8d[_0x166b3b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x5f46a6,_0x50caed){Object['defineProperty'](_0x5f46a6,'default',{'enumerable':!0x0,'value':_0x50caed});}:function(_0x142b5b,_0x36ae28){_0x142b5b['default']=_0x36ae28;}),__importStar=this&&this['__importStar']||function(_0x48a77c){if(_0x48a77c&&_0x48a77c['__esModule'])return _0x48a77c;var _0x408f4e={};if(null!=_0x48a77c)for(var _0x4388ed in _0x48a77c)'default'!==_0x4388ed&&Object['prototype']['hasOwnProperty']['call'](_0x48a77c,_0x4388ed)&&__createBinding(_0x408f4e,_0x48a77c,_0x4388ed);return __setModuleDefault(_0x408f4e,_0x48a77c),_0x408f4e;},__importDefault=this&&this['__importDefault']||function(_0x53f002){return _0x53f002&&_0x53f002['__esModule']?_0x53f002:{'default':_0x53f002};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addsuggestionmessage_1=__importDefault(require('./messages/addsuggestionmessage')),addsuggestionresponse_1=__importDefault(require('./responses/addsuggestionresponse')),getsuggestionmessage_1=__importDefault(require('./messages/getsuggestionmessage')),getsuggestionresponse_1=__importDefault(require('./responses/getsuggestionresponse')),getallsuggestionsmessage_1=__importDefault(require('./messages/getallsuggestionsmessage')),getallsuggestionsresponse_1=__importDefault(require('./responses/getallsuggestionsresponse')),updatesuggestionmessage_1=__importDefault(require('./messages/updatesuggestionmessage')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError')),ckeditorcloudservicesservererror_1=__importDefault(require('../ckeditorcloudservicesservererror')),batchUpdateSuggestionsStateMessage_1=__importDefault(require('./messages/batchUpdateSuggestionsStateMessage'));exports['_SERVICE']=0xa;class TrackChangesService{constructor(_0x39c030){this['_documentId']=_0x39c030,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x44c32f){if(this['_isConnected'])return;if(_0x44c32f['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x44c32f);const _0x232e39=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x44c32f,this['stopListening'](_0x44c32f,'change:state');const _0x37df81=await _0x44c32f['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x232e39)),_0x431520=messagescompressor_1['default']['decode'](_0x37df81,connectresponse_1['default']);return this['listenTo'](_0x44c32f,'change:state',(_0x244ca1,_0x52acd9,_0x1a0c08)=>this['_onWsGatewayStateChange'](_0x1a0c08),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x44c32f,_0x431520['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x431520['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x3ca600,_0x16830f,_0x4c11fd,_0x167b0b=null,_0x3786a9){const _0x1b865d=new addsuggestionmessage_1['default'](_0x3ca600,this['_documentId'],_0x16830f,_0x4c11fd,_0x167b0b,_0x3786a9),_0x51a522=await this['_sendRequest'](addsuggestionmessage_1['default']['TYPE'],_0x1b865d);return messagescompressor_1['default']['decode'](_0x51a522,addsuggestionresponse_1['default']);}async['get'](_0x1bcaa9,_0x51b63b=0x1){const _0x309fb4=new getsuggestionmessage_1['default'](_0x1bcaa9,this['_documentId']);try{const _0x538771=await this['_sendRequest'](getsuggestionmessage_1['default']['TYPE'],_0x309fb4);return messagescompressor_1['default']['decode'](_0x538771,getsuggestionresponse_1['default']);}catch(_0x36836f){if(_0x36836f instanceof ckeditorcloudservicesservererror_1['default']&&'404'===_0x36836f['code']&&_0x51b63b<0x5)return await(_0x5a8cfd=0x64*_0x51b63b,new Promise(_0x3db394=>{setTimeout(_0x3db394,_0x5a8cfd);})),this['get'](_0x1bcaa9,_0x51b63b+0x1);if(_0x36836f instanceof ckeditorcloudservicesservererror_1['default'])throw _0x36836f;throw ckeditorcloudservicesservererror_1['default']['fromPublicError'](_0x36836f);}var _0x5a8cfd;}async['getAll'](){const _0x67eeb1=new getallsuggestionsmessage_1['default'](this['_documentId']),_0x3e02b4=await this['_sendRequest'](getallsuggestionsmessage_1['default']['TYPE'],_0x67eeb1),{suggestions:suggestions}=messagescompressor_1['default']['decode'](_0x3e02b4,getallsuggestionsresponse_1['default']);return suggestions;}async['update'](_0x3ea513,_0x6b9057={}){const {hasComments:hasComments,state:state,attributes:attributes}=_0x6b9057,_0x1a4bb7=void 0x0!==hasComments,_0x5a6c5b=new updatesuggestionmessage_1['default'](_0x3ea513,this['_documentId'],hasComments,_0x1a4bb7,state,attributes);await this['_sendRequest'](updatesuggestionmessage_1['default']['TYPE'],_0x5a6c5b);}async['batchUpdateState'](_0x10b98f){const _0x32bab4=new batchUpdateSuggestionsStateMessage_1['default'](_0x10b98f['ids'],this['_documentId'],_0x10b98f['state']);await this['_sendRequest'](batchUpdateSuggestionsStateMessage_1['default']['TYPE'],_0x32bab4);}['_connectToChannel'](_0x57cf86,_0x1e669e){this['_channel']=_0x57cf86['_getChannel'](TrackChangesService['_SERVICE'],_0x1e669e),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatesuggestionmessage_1['default']['TYPE']),(_0x316b94,_0x3cfddb)=>{const _0x3cac6f=messagescompressor_1['default']['decode'](_0x3cfddb,updatesuggestionmessage_1['default']);this['fire']('suggestionUpdated',_0x3cac6f);});}['_onWsGatewayStateChange'](_0x208daf){_0x208daf===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x2a98e3,_0x6e16d3){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x2a98e3,messagescompressor_1['default']['encode'](_0x6e16d3));}}TrackChangesService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(TrackChangesService,utils_1['EmitterMixin']),exports['default']=TrackChangesService;