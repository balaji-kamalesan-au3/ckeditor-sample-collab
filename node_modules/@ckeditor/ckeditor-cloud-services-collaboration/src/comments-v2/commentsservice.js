/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x48c57b,_0x37eb87,_0x402952,_0x55e1e0){void 0x0===_0x55e1e0&&(_0x55e1e0=_0x402952),Object['defineProperty'](_0x48c57b,_0x55e1e0,{'enumerable':!0x0,'get':function(){return _0x37eb87[_0x402952];}});}:function(_0x5d55dc,_0x5213da,_0x11f174,_0x53ef97){void 0x0===_0x53ef97&&(_0x53ef97=_0x11f174),_0x5d55dc[_0x53ef97]=_0x5213da[_0x11f174];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x37376c,_0x21f699){Object['defineProperty'](_0x37376c,'default',{'enumerable':!0x0,'value':_0x21f699});}:function(_0x32fceb,_0x34c7a0){_0x32fceb['default']=_0x34c7a0;}),__importStar=this&&this['__importStar']||function(_0x3203e1){if(_0x3203e1&&_0x3203e1['__esModule'])return _0x3203e1;var _0x3ed283={};if(null!=_0x3203e1)for(var _0x5647a9 in _0x3203e1)'default'!==_0x5647a9&&Object['prototype']['hasOwnProperty']['call'](_0x3203e1,_0x5647a9)&&__createBinding(_0x3ed283,_0x3203e1,_0x5647a9);return __setModuleDefault(_0x3ed283,_0x3203e1),_0x3ed283;},__importDefault=this&&this['__importDefault']||function(_0x305285){return _0x305285&&_0x305285['__esModule']?_0x305285:{'default':_0x305285};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addcommentmessage_1=__importDefault(require('./messages/addcommentmessage')),addcommentresponse_1=__importDefault(require('./responses/addcommentresponse')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),removecommentmessage_1=__importDefault(require('./messages/removecommentmessage')),removecommentthreadmessage_1=__importDefault(require('./messages/removecommentthreadmessage')),updatecommentmessage_1=__importDefault(require('./messages/updatecommentmessage')),getcommentthreadmessage_1=__importDefault(require('./messages/getcommentthreadmessage')),getcommentthreadresponse_1=__importDefault(require('./responses/getcommentthreadresponse')),getdocumentthreadsmessage_1=__importDefault(require('./messages/getdocumentthreadsmessage')),getdocumentthreadsresponse_1=__importDefault(require('./responses/getdocumentthreadsresponse')),websocketgateway_1=__importStar(require('./../websocketgateway/websocketgateway')),ckeditorcloudserviceserror_1=__importDefault(require('./../ckeditorcloudserviceserror')),sessions_1=__importDefault(require('../sessions/sessions')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError')),ckeditorcloudservicesservererror_1=__importDefault(require('../ckeditorcloudservicesservererror'));exports['_SERVICE']=0x9;class CommentsService{constructor(_0x4fb1d8){this['_documentId']=_0x4fb1d8,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x538911){if(this['_isConnected'])return;if(_0x538911['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x538911);const _0x1bd89a=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x538911,this['stopListening'](_0x538911,'change:state');const _0x47c75f=await _0x538911['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x1bd89a)),{channel:channel,threads:threads}=messagescompressor_1['default']['decode'](_0x47c75f,connectresponse_1['default']);return this['listenTo'](_0x538911,'change:state',(_0x598793,_0x2a949c,_0x3dab42)=>this['_onWsGatewayStateChange'](_0x3dab42),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x538911,channel),this['_isConnected']=!0x0,this['fire']('connected'),threads;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x42af30,_0x4934b4,_0x4a91ac,_0x470908){const _0x32dc0a=new addcommentmessage_1['default'](this['_documentId'],_0x42af30,_0x4a91ac,_0x4934b4,void 0x0,void 0x0,_0x470908),_0x849c31=await this['_sendRequest'](addcommentmessage_1['default']['TYPE'],_0x32dc0a);return messagescompressor_1['default']['decode'](_0x849c31,addcommentresponse_1['default']);}async['updateComment'](_0x5d799f,_0x5670ee,_0x3b502f,_0x1a1274){const _0x542ea2=void 0x0!==_0x1a1274,_0x3c4ceb=new updatecommentmessage_1['default'](this['_documentId'],_0x5d799f,_0x5670ee,_0x3b502f,_0x1a1274,_0x542ea2);await this['_sendRequest'](updatecommentmessage_1['default']['TYPE'],_0x3c4ceb);}async['removeComment'](_0x3b9c6b,_0x198562){const _0x56580c=new removecommentmessage_1['default'](this['_documentId'],_0x3b9c6b,_0x198562);await this['_sendRequest'](removecommentmessage_1['default']['TYPE'],_0x56580c);}async['removeCommentThread'](_0x201ef0){const _0x1fe207=new removecommentthreadmessage_1['default'](this['_documentId'],_0x201ef0);await this['_sendRequest'](removecommentthreadmessage_1['default']['TYPE'],_0x1fe207);}async['getCommentThread'](_0xc09710,_0x52e274=0x1){const _0x152136=new getcommentthreadmessage_1['default'](_0xc09710,this['_documentId']);try{const _0x115d1e=await this['_sendRequest'](getcommentthreadmessage_1['default']['TYPE'],_0x152136),{comments:comments,commentThreadId:_0x59c503}=messagescompressor_1['default']['decode'](_0x115d1e,getcommentthreadresponse_1['default']);return{'comments':comments,'commentThreadId':_0x59c503};}catch(_0x225142){if(_0x225142 instanceof ckeditorcloudservicesservererror_1['default']&&'404'===_0x225142['code']&&_0x52e274<0x5)return await(_0xed47f7=0x64*_0x52e274,new Promise(_0x1dfa5a=>{setTimeout(_0x1dfa5a,_0xed47f7);})),this['getCommentThread'](_0xc09710,_0x52e274+0x1);if(_0x225142 instanceof ckeditorcloudservicesservererror_1['default'])throw _0x225142;throw ckeditorcloudservicesservererror_1['default']['fromPublicError'](_0x225142);}var _0xed47f7;}async['getDocumentThreads'](){const _0x343319=new getdocumentthreadsmessage_1['default'](this['_documentId']),_0x12f129=await this['_sendRequest'](getdocumentthreadsmessage_1['default']['TYPE'],_0x343319),{threads:threads}=messagescompressor_1['default']['decode'](_0x12f129,getdocumentthreadsresponse_1['default']);return{'threads':threads};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await sessions_1['default']['getConnectedSessions'](this['_wsGateway'],this['_documentId'],exports['_SERVICE'])),this['_connectedSessions'];}['_connectToChannel'](_0x32e8ed,_0x146111){this['_channel']=_0x32e8ed['_getChannel'](CommentsService['_SERVICE'],_0x146111),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](addcommentmessage_1['default']['TYPE']),(_0x2bbebe,_0x31da32)=>{const _0x4ee621=messagescompressor_1['default']['decode'](_0x31da32,addcommentmessage_1['default']);this['fire']('commentAdded',_0x4ee621);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentmessage_1['default']['TYPE']),(_0x2022a5,_0x53d2d5)=>{const _0x429d66=messagescompressor_1['default']['decode'](_0x53d2d5,removecommentmessage_1['default']);this['fire']('commentRemoved',_0x429d66);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatecommentmessage_1['default']['TYPE']),(_0x771757,_0x348f2f)=>{const _0x8ae99a=messagescompressor_1['default']['decode'](_0x348f2f,updatecommentmessage_1['default']);this['fire']('commentUpdated',_0x8ae99a);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentthreadmessage_1['default']['TYPE']),(_0x2e6e17,_0x36552a)=>{const _0x25311e=messagescompressor_1['default']['decode'](_0x36552a,removecommentthreadmessage_1['default']);this['fire']('commentThreadRemoved',_0x25311e);}));}['_onWsGatewayStateChange'](_0x21f690){_0x21f690===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1712c9,_0x2441a4){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x1712c9,messagescompressor_1['default']['encode'](_0x2441a4));}}CommentsService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(CommentsService,utils_1['EmitterMixin']),exports['default']=CommentsService;