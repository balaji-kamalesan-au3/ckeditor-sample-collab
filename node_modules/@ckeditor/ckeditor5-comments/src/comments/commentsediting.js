/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x13c8=['document','name','_threadToController','map','render','delete','ready','for','left','isThreadsLoadingPaused','$graveyard','once','registerAnnotation','sort','CommentsEditing','length','model','init','createElement','top','destroy','filter','fetchCommentThread','removeMarker','getAttribute','isEqual','differ','text','markers','change:activeMarker','_handleMarkerAddAndRemove','then','getByInnerView','change','_initializeMarkerConverters','start','markerToData','collaboration.channelId','listenTo','conversion','markerName','registerPostFixer','createRange','ck-comment-marker--active','$marker','schema','switchReadOnly','activeMarker','dataToMarker','requires','isCollapsed','elementToElement','markerToHighlight','split','editor','high','update:comment','upcast','_threads','Annotations','newRange','destroyed','editing','comment','set','view','state','getChangedMarkers','config','size','openNewCommentThread','_detachCommentThread','_attachedThreads','end','updateMarker','createPositionBefore','getAllMarkersForId','CommentsRepository','dataDowncast','push','addComment','getCommentThreads','reconvertMarker','removeCommentThread','affectsData','comment:','hasCommentThread','hasMarkerForId','addCommentThread','getCommentThread','plugins','stop','get','_attachMarkerToThread','add','isObject'];(function(_0x2acbe7,_0x13c820){const _0x1f8c42=function(_0xc1c7de){while(--_0xc1c7de){_0x2acbe7['push'](_0x2acbe7['shift']());}};_0x1f8c42(++_0x13c820);}(_0x13c8,0x117));const _0x1f8c=function(_0x2acbe7,_0x13c820){_0x2acbe7=_0x2acbe7-0x0;let _0x1f8c42=_0x13c8[_0x2acbe7];return _0x1f8c42;};import{Plugin as _0x53d641}from'ckeditor5/src/core';import{Rect as _0xa8b038}from'ckeditor5/src/utils';import _0x21e911 from'./commentsrepository';import _0x182b1f from'./addcommentthreadcommand';import{getMarkerDomElement as _0x2a03e4}from'ckeditor5-collaboration/src/collaboration-core';import _0x25f891 from'../annotations/editorannotations';import _0x29da17 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';import _0x119ba5 from'./integrations/importword';export default class r extends _0x53d641{static get[_0x1f8c('0x3a')](){return[_0x21e911,_0x25f891,_0x29da17,_0x119ba5];}static get['pluginName'](){return _0x1f8c('0x17');}constructor(_0x5518cf){super(_0x5518cf),this[_0x1f8c('0x49')](_0x1f8c('0x12'),!0x0),_0x5518cf['data'][_0x1f8c('0x14')](_0x1f8c('0xf'),()=>this[_0x1f8c('0x12')]=!0x1),this[_0x1f8c('0x49')]('activeMarker',null),this['on'](_0x1f8c('0x26'),(_0x3e1a81,_0x14967f,_0x43e15f,_0x1bcbb7)=>{_0x5518cf[_0x1f8c('0x19')][_0x1f8c('0x2a')](()=>{if(_0x43e15f){const {id:_0x3290c7}=H(_0x43e15f),_0x5cd479=this['getAllMarkersForId'](_0x3290c7);for(const _0x542280 of _0x5cd479)_0x5518cf[_0x1f8c('0x47')][_0x1f8c('0x5b')](_0x542280);}if(_0x1bcbb7){const {id:_0x17c467}=H(_0x1bcbb7),_0x228ec1=this['getAllMarkersForId'](_0x17c467);for(const _0x1ae611 of _0x228ec1)_0x5518cf[_0x1f8c('0x47')][_0x1f8c('0x5b')](_0x1ae611);}});}),this['_attachedThreads']=new Map();}[_0x1f8c('0x1a')](){const _0x194fe4=this['editor'],_0x1c6599=_0x194fe4[_0x1f8c('0x3')][_0x1f8c('0x5')](_0x1f8c('0x56')),_0x31912e=_0x194fe4[_0x1f8c('0x4d')]['get'](_0x1f8c('0x2e'));_0x194fe4['commands'][_0x1f8c('0x7')](_0x1f8c('0x1'),new _0x182b1f(_0x194fe4)),this[_0x1f8c('0x2f')](_0x194fe4,'change:isReadOnly',(_0x42dee1,_0x378c81,_0x1c7877)=>{_0x1c6599[_0x1f8c('0x37')](_0x1c7877,_0x194fe4[_0x1f8c('0x4d')][_0x1f8c('0x5')](_0x1f8c('0x2e')));}),this[_0x1f8c('0x2f')](_0x1c6599,G(_0x1f8c('0x5c'),_0x31912e),(_0x384d7f,{threadId:_0x21e029})=>{_0x194fe4[_0x1f8c('0x19')][_0x1f8c('0x2a')](_0x34c1cd=>{for(const _0xe0b412 of this[_0x1f8c('0x55')](_0x21e029))_0x34c1cd[_0x1f8c('0x20')](_0xe0b412);});const _0x143e03=_0x1c6599['getCommentThread'](_0x21e029);_0x1c6599[_0x1f8c('0x5f')](_0x21e029)&&!_0x143e03['length']||_0x384d7f[_0x1f8c('0x4')]();},{'priority':_0x1f8c('0x40')}),this[_0x1f8c('0x2f')](_0x1c6599,G(_0x1f8c('0x59'),_0x31912e),(_0x176a41,{threadId:_0x95c3fe,isFromAdapter:_0x4c592})=>{const _0xfb236=this[_0x1f8c('0x55')](_0x95c3fe);if(_0x4c592||0x0==_0xfb236[_0x1f8c('0x18')]||!_0x1c6599['hasCommentThread'](_0x95c3fe))return;0x1===_0x1c6599[_0x1f8c('0x2')](_0x95c3fe)[_0x1f8c('0x18')]&&_0x194fe4['model'][_0x1f8c('0x2a')](_0x120d09=>{for(const _0x5598a8 of _0xfb236)_0x120d09[_0x1f8c('0x53')](_0x5598a8,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':'low'}),this[_0x1f8c('0x2b')](),this[_0x1f8c('0x27')]();}[_0x1f8c('0x1d')](){const _0xe3993c=this[_0x1f8c('0x3f')][_0x1f8c('0x3')][_0x1f8c('0x5')](_0x1f8c('0x56')),_0xe37124=this[_0x1f8c('0x3f')]['config'][_0x1f8c('0x5')](_0x1f8c('0x2e'));for(const _0x24fb0d of _0xe3993c[_0x1f8c('0x5a')]({'channelId':_0xe37124}))_0xe3993c[_0x1f8c('0x50')](_0x24fb0d['id']),_0xe3993c[_0x1f8c('0x43')]['delete'](_0x24fb0d['id']);super[_0x1f8c('0x1d')]();}[_0x1f8c('0x0')](_0x4b0ae8){return this[_0x1f8c('0x55')](_0x4b0ae8)[_0x1f8c('0x18')]>0x0;}[_0x1f8c('0x55')](_0x4b24c2){return(this[_0x1f8c('0x51')]['get'](_0x4b24c2)||[])['map'](_0x19faf9=>this[_0x1f8c('0x3f')][_0x1f8c('0x19')]['markers']['get'](_0x19faf9))[_0x1f8c('0x1e')](_0x299d96=>_0x299d96);}[_0x1f8c('0x2b')](){const _0x77fc5e=this[_0x1f8c('0x3f')];_0x77fc5e['conversion'][_0x1f8c('0x10')]('editingDowncast')[_0x1f8c('0x3d')]({'model':'comment','view':_0x196971=>{const {id:_0x2f6c76}=H(_0x196971[_0x1f8c('0x31')]),_0x1c7916=['ck-comment-marker'];return this['activeMarker']&&H(this[_0x1f8c('0x38')])['id']===_0x2f6c76&&_0x1c7916[_0x1f8c('0x58')](_0x1f8c('0x34')),{'classes':_0x1c7916,'attributes':{'data-comment':_0x2f6c76}};}}),_0x77fc5e[_0x1f8c('0x30')][_0x1f8c('0x10')](_0x1f8c('0x57'))[_0x1f8c('0x2d')]({'model':'comment','view':_0x513ed8=>{const _0x2838c7=_0x77fc5e[_0x1f8c('0x19')][_0x1f8c('0x25')][_0x1f8c('0x5')](_0x513ed8),{id:_0x4a02bb,part:_0xab5083}=H(_0x513ed8);return _0x2838c7&&!_0x2838c7[_0x1f8c('0x5d')]?null:{'group':'comment','name':_0xab5083?_0x4a02bb+':'+_0xab5083:_0x4a02bb};}}),_0x77fc5e['conversion'][_0x1f8c('0x10')]('upcast')[_0x1f8c('0x3c')]({'view':{'name':_0x1f8c('0x48'),'attribute':{'id':/^\w/}},'model':(_0x3f06b8,{writer:_0x1f8fec})=>_0x1f8fec[_0x1f8c('0x1b')](_0x1f8c('0x35'),{'data-name':_0x1f8c('0x5e')+_0x3f06b8[_0x1f8c('0x21')]('id')})}),_0x77fc5e['conversion'][_0x1f8c('0x10')](_0x1f8c('0x42'))[_0x1f8c('0x39')]({'view':'comment'});}[_0x1f8c('0x27')](){const _0x5290f4=this[_0x1f8c('0x3f')],_0x52e35a=_0x5290f4[_0x1f8c('0x3')][_0x1f8c('0x5')](_0x1f8c('0x56')),_0x219f67=new Set();_0x5290f4[_0x1f8c('0x19')][_0x1f8c('0x9')][_0x1f8c('0x32')](_0x24c158=>{let _0x48d641=!0x1;for(const {name:_0xb67ff4,data:_0x167324}of _0x5290f4[_0x1f8c('0x19')][_0x1f8c('0x9')][_0x1f8c('0x23')][_0x1f8c('0x4c')]()){const {group:_0x10ae30,id:_0x8b2a0d}=H(_0xb67ff4);let _0x437eaf=_0x167324[_0x1f8c('0x45')];if(_0x1f8c('0x48')!==_0x10ae30||!_0x437eaf)continue;const _0x36a389=_0x1f8c('0x13')===_0x437eaf['root']['rootName'];_0x36a389||(_0x437eaf=J(_0x437eaf,_0x5290f4[_0x1f8c('0x19')]),!_0x437eaf||_0x437eaf[_0x1f8c('0x22')](_0x167324[_0x1f8c('0x45')]))?!_0x437eaf||!_0x5290f4[_0x1f8c('0x19')]['hasContent'](_0x437eaf)||this[_0x1f8c('0x51')]['has'](_0x8b2a0d)&&_0x36a389?(_0x24c158['removeMarker'](_0xb67ff4),_0x48d641=!0x0):_0x36a389||(this[_0x1f8c('0x12')]?_0x219f67[_0x1f8c('0x7')](_0xb67ff4):this[_0x1f8c('0x6')](_0xb67ff4,_0x8b2a0d)):(_0x24c158[_0x1f8c('0x53')](_0xb67ff4,{'range':_0x437eaf}),_0x48d641=!0x0);}return _0x48d641;}),this['on']('change:isThreadsLoadingPaused',(_0x5c019b,_0x4bf15b,_0x281479)=>{if(!_0x281479&&_0x219f67[_0x1f8c('0x4e')])for(const _0x330e34 of _0x219f67){const {id:_0x4b8a9d}=H(_0x330e34);_0x219f67[_0x1f8c('0xe')](_0x4b8a9d),_0x5290f4['model'][_0x1f8c('0x25')]['get'](_0x330e34)&&this[_0x1f8c('0x6')](_0x330e34,_0x4b8a9d);}}),this[_0x1f8c('0x2f')](_0x5290f4[_0x1f8c('0x19')][_0x1f8c('0x25')],_0x1f8c('0x41'),(_0x6d8953,_0x3b3278,_0x4683d6,_0x5f00ee)=>{if(_0x5f00ee)return;const {id:_0x19ece6}=H(_0x3b3278[_0x1f8c('0xa')]),_0x2bbb68=_0x5290f4['plugins'][_0x1f8c('0x5')](_0x1f8c('0x56'))['getCommentThread'](_0x19ece6);_0x219f67[_0x1f8c('0xe')](_0x19ece6),_0x2bbb68&&!this[_0x1f8c('0x0')](_0x19ece6)&&(this[_0x1f8c('0x51')][_0x1f8c('0xe')](_0x19ece6),_0x52e35a[_0x1f8c('0x50')](_0x19ece6));});}[_0x1f8c('0x6')](_0xe343f3,_0x565429){if(this[_0x1f8c('0x51')]['has'](_0x565429)){const _0x341420=this[_0x1f8c('0x51')][_0x1f8c('0x5')](_0x565429);return void(_0x341420['includes'](_0xe343f3)||_0x341420[_0x1f8c('0x58')](_0xe343f3));}this[_0x1f8c('0x51')][_0x1f8c('0x49')](_0x565429,[_0xe343f3]);const _0x11aa60=this[_0x1f8c('0x3f')],_0x5c88ce=_0x11aa60[_0x1f8c('0x3')][_0x1f8c('0x5')](_0x1f8c('0x56')),_0x5714c3=_0x11aa60[_0x1f8c('0x4d')][_0x1f8c('0x5')](_0x1f8c('0x2e')),_0x4ca8f4=_0x11aa60[_0x1f8c('0x3')][_0x1f8c('0x5')]('EditorAnnotations'),_0x11b5ea=()=>{const _0x24e795=this[_0x1f8c('0x55')](_0x565429);if(0x0===_0x24e795[_0x1f8c('0x18')])return null;if(0x1===_0x24e795[_0x1f8c('0x18')])return _0x2a03e4(_0x11aa60[_0x1f8c('0x47')],_0x24e795[0x0]);const _0x241479=_0x24e795[_0x1f8c('0xc')](_0x5a3361=>_0x2a03e4(_0x11aa60[_0x1f8c('0x47')],_0x5a3361));return _0x241479[_0x1f8c('0x16')]((_0x5cfbaf,_0x196f9e)=>{const _0xa79c80=new _0xa8b038(_0x5cfbaf),_0x49e696=new _0xa8b038(_0x196f9e),_0x817b9f=_0xa79c80[_0x1f8c('0x1c')]-_0x49e696['top'];return 0x0==_0x817b9f?_0xa79c80[_0x1f8c('0x11')]-_0x49e696[_0x1f8c('0x11')]:_0x817b9f;}),_0x241479[0x0];};!this[_0x1f8c('0x55')](_0x565429)[0x0]['managedUsingOperations']?_0x11aa60['editing'][_0x1f8c('0x4a')][_0x1f8c('0x14')](_0x1f8c('0xd'),()=>{const _0x5416ee=_0x11aa60[_0x1f8c('0x3')]['get'](_0x1f8c('0x44')),_0x7b8aa=_0x5c88ce[_0x1f8c('0x4f')]({'channelId':_0x5714c3,'threadId':_0x565429,'target':_0x11b5ea}),_0x358561=_0x5c88ce[_0x1f8c('0xb')]['get'](_0x7b8aa)['view'],_0x33e5af=_0x5416ee[_0x1f8c('0x29')](_0x358561);_0x4ca8f4['registerAnnotation'](_0x33e5af);},{'priority':'low'}):_0x5c88ce[_0x1f8c('0x1f')]({'channelId':_0x5714c3,'threadId':_0x565429})[_0x1f8c('0x28')](_0x1f69a9=>{if(_0x1f8c('0x46')!==_0x11aa60[_0x1f8c('0x4b')]){if(_0x1f69a9){const _0x16ff38=_0x1f69a9['attachTo'](_0x11b5ea);_0x4ca8f4[_0x1f8c('0x15')](_0x16ff38);}else{const _0x468eba=this[_0x1f8c('0x55')](_0x565429);_0x11aa60[_0x1f8c('0x19')][_0x1f8c('0x2a')](_0x8c887d=>{for(const _0x4fd25d of _0x468eba)_0x8c887d['removeMarker'](_0x4fd25d);});}}});}}function G(_0x48b096,_0x4ac349){return _0x4ac349?_0x48b096+':'+_0x4ac349:_0x48b096;}function H(_0x101e30){const _0x145b72=_0x101e30[_0x1f8c('0x3e')](':');return{'group':_0x145b72[0x0],'id':_0x145b72[0x1],'part':_0x145b72[0x2]};}function J(_0x5ed8fb,_0x304c70){const _0x14b84a=_0x304c70[_0x1f8c('0x36')],_0x1b56d7=_0x304c70[_0x1f8c('0x33')](_0x5ed8fb[_0x1f8c('0x2c')]);for(const _0x4f4388 of _0x5ed8fb['getWalker']()){const {type:_0x32cce4,item:_0x4cb3a0,nextPosition:_0x55cb8f}=_0x4f4388;if(_0x1f8c('0x24')===_0x32cce4||_0x14b84a[_0x1f8c('0x8')](_0x4cb3a0)){const _0xd8a49d=_0x304c70[_0x1f8c('0x54')](_0x4cb3a0);_0x1b56d7[_0x1f8c('0x3b')]&&(_0x1b56d7['start']=_0xd8a49d),_0x1b56d7[_0x1f8c('0x52')]=_0x55cb8f;}}return _0x1b56d7['isCollapsed']?null:_0x1b56d7;}