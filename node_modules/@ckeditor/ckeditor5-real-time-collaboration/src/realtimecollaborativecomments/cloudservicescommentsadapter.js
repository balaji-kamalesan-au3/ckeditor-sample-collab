/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5924=['cloudservicescommentsadapter-disconnect-not-exist','_setUpService','keys','update','mySessionId','catch','from','content','addUser','startsWith','cloud-services-internal-error:\x20Not\x20connected.','assign','reconnect','removeCommentThread','_getService','createdAt','updateComment','context','off','config','set','cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.','collaboration.channelId','getConnectedSessions','add','sessionAdd:','permissions','destroy','addCommentThread','size','404','getCommentThread','commentThreadId','CommentsService','plugins','listenTo','has','get','register','_fetchMissingUsersForThreads','commentRemoved','commentId','requires','getUser','addComment','CommentsRepository','remove','_connectService','comments','map','userId','connect','getComment','message','_terminateService','init','cloud-services-internal-error:\x20Request\x20timeout.','_services'];(function(_0x182576,_0x5924af){const _0x3a1721=function(_0x102066){while(--_0x102066){_0x182576['push'](_0x182576['shift']());}};_0x3a1721(++_0x5924af);}(_0x5924,0xc9));const _0x3a17=function(_0x182576,_0x5924af){_0x182576=_0x182576-0x0;let _0x3a1721=_0x5924[_0x182576];return _0x3a1721;};import{Context as _0x1388ea,ContextPlugin as _0x397bc1}from'ckeditor5/src/core';import{CKEditorError as _0x51cbc1}from'ckeditor5/src/utils';import{Users as _0x53a40a}from'ckeditor5-collaboration/src/collaboration-core';import _0x33a86f from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x5cefd8 from'@ckeditor/ckeditor-cloud-services-collaboration/src/comments-v2/commentsservice';import _0x5520ec from'../realtimecollaborativeediting/websocketgateway';import _0x36a146 from'../realtimecollaborativeediting/sessions';export default class a extends _0x397bc1{static get[_0x3a17('0xf')](){return[_0x5520ec,_0x3a17('0x12'),_0x36a146,_0x53a40a];}constructor(_0x28c0b1){super(_0x28c0b1),this[_0x3a17('0x1e')]=new Map();}async[_0x3a17('0x1c')](){const _0x11acae=this[_0x3a17('0x30')],_0x1b3fd2=_0x11acae[_0x3a17('0x7')][_0x3a17('0xa')](_0x3a17('0x12'));if(_0x11acae['plugins'][_0x3a17('0xa')](_0x5520ec)['addToReconnectionStack'](this),_0x1b3fd2['adapter']={'getCommentThread':async({channelId:_0x33702c,threadId:_0x4c571c})=>{const _0x1b016f=await this[_0x3a17('0x2d')](_0x33702c)[_0x3a17('0x4')](_0x4c571c)[_0x3a17('0x24')](R);return await this[_0x3a17('0xc')]([_0x1b016f]),{'threadId':_0x1b016f[_0x3a17('0x5')],'comments':_0x1b016f['comments'][_0x3a17('0x16')](T)};},'removeCommentThread':({channelId:_0x3538d5,threadId:_0x2d1872})=>this[_0x3a17('0x2d')](_0x3538d5)[_0x3a17('0x2c')](_0x2d1872)[_0x3a17('0x24')](S)[_0x3a17('0x24')](R),'addComment':({channelId:_0x6fe0ac,threadId:_0x33dbb3,commentId:_0x455f89,content:_0x3e8334,attributes:_0x19d27f})=>this[_0x3a17('0x2d')](_0x6fe0ac)[_0x3a17('0x11')](_0x33dbb3,_0x455f89,_0x3e8334,_0x19d27f)[_0x3a17('0x24')](R),'updateComment':({channelId:_0x30e3b2,threadId:_0x6e6639,commentId:_0x16cbd8,content:_0x4a211e,attributes:_0x66c5c3})=>this[_0x3a17('0x2d')](_0x30e3b2)[_0x3a17('0x2f')](_0x6e6639,_0x16cbd8,_0x4a211e,_0x66c5c3)[_0x3a17('0x24')](S)[_0x3a17('0x24')](R),'removeComment':({channelId:_0x40b500,threadId:_0x5bb7c5,commentId:_0x4ec780})=>this[_0x3a17('0x2d')](_0x40b500)['removeComment'](_0x5bb7c5,_0x4ec780)[_0x3a17('0x24')](S)[_0x3a17('0x24')](R)},_0x11acae instanceof _0x1388ea){const _0x547b03=_0x11acae[_0x3a17('0x32')][_0x3a17('0xa')](_0x3a17('0x35')),_0x56b6fa=_0x11acae['plugins']['get'](_0x36a146);await this[_0x3a17('0x20')](_0x547b03);const _0x112361=await this[_0x3a17('0x1e')][_0x3a17('0xa')](_0x547b03)[_0x3a17('0x36')]();this[_0x3a17('0x8')](_0x56b6fa,_0x3a17('0x38')+_0x547b03,(_0x53d813,{session:_0x5d6cce})=>{_0x5d6cce['id']===_0x56b6fa[_0x3a17('0x23')]&&(_0x53d813[_0x3a17('0x31')](),this[_0x3a17('0x30')]['plugins'][_0x3a17('0xa')]('Permissions')['setPermissions'](_0x5d6cce[_0x3a17('0x39')],_0x547b03));}),_0x56b6fa[_0x3a17('0xb')](_0x547b03,_0x112361);}}async[_0x3a17('0x20')](_0x33fae5){if(this[_0x3a17('0x1e')][_0x3a17('0x9')](_0x33fae5))throw new _0x51cbc1('cloudservicescommentsadapter-connect-already-connected',null,{'channelId':_0x33fae5});const _0xe63f95=this[_0x3a17('0x30')][_0x3a17('0x7')][_0x3a17('0xa')]('CommentsRepository'),_0x56bb82=new a[(_0x3a17('0x6'))](_0x33fae5);this[_0x3a17('0x1e')][_0x3a17('0x33')](_0x33fae5,_0x56bb82),this['listenTo'](_0x56bb82,'commentThreadRemoved',(_0x5ae164,{commentThreadId:_0x5e1288})=>{const _0x3a5272=_0xe63f95[_0x3a17('0x4')](_0x5e1288);_0x3a5272&&_0x3a5272[_0x3a17('0x13')]({'isFromAdapter':!0x0});}),this[_0x3a17('0x8')](_0x56bb82,'commentAdded',(_0x592772,_0x4e3a9c)=>{const _0x4974df=_0x4e3a9c[_0x3a17('0x5')];_0xe63f95['hasCommentThread'](_0x4974df)||_0xe63f95[_0x3a17('0x1')]({'channelId':_0x33fae5,'threadId':_0x4974df,'isFromAdapter':!0x0});const _0x129615=_0xe63f95[_0x3a17('0x4')](_0x4974df);_0x129615&&_0x129615[_0x3a17('0x11')](Object[_0x3a17('0x2a')](T(_0x4e3a9c),{'isFromAdapter':!0x0}));}),this[_0x3a17('0x8')](_0x56bb82,'commentUpdated',(_0x5b4763,{commentThreadId:_0x1f70b7,commentId:_0x192795,content:_0x39ed24,attributes:_0x27d253})=>{const _0x4ded7f=_0xe63f95[_0x3a17('0x4')](_0x1f70b7);if(_0x4ded7f){const _0x457f27=_0x4ded7f[_0x3a17('0x19')](_0x192795);_0x457f27&&_0x457f27['update']({'content':_0x39ed24,'attributes':_0x27d253,'isFromAdapter':!0x0});}}),this[_0x3a17('0x8')](_0x56bb82,_0x3a17('0xd'),(_0x12d55a,{commentThreadId:_0x520335,commentId:_0x1b0759})=>{const _0x4c21a9=_0xe63f95[_0x3a17('0x4')](_0x520335);if(_0x4c21a9){const _0x3a86d7=_0x4c21a9[_0x3a17('0x19')](_0x1b0759);_0x3a86d7&&_0x3a86d7[_0x3a17('0x13')]({'isFromAdapter':!0x0});}}),await this[_0x3a17('0x14')](_0x33fae5);}[_0x3a17('0x0')](){if(this[_0x3a17('0x30')]instanceof _0x1388ea){const _0x129086=this[_0x3a17('0x30')][_0x3a17('0x32')][_0x3a17('0xa')]('collaboration.channelId');this[_0x3a17('0x1b')](_0x129086);}}['_terminateService'](_0x1a7f28){if(!this[_0x3a17('0x1e')]['has'](_0x1a7f28))throw new _0x51cbc1(_0x3a17('0x1f'),null,{'channelId':_0x1a7f28});this[_0x3a17('0x2d')](_0x1a7f28)['disconnect'](),this[_0x3a17('0x1e')]['delete'](_0x1a7f28);}async[_0x3a17('0x2b')](){for(const _0x283428 of this[_0x3a17('0x1e')][_0x3a17('0x21')]())await this[_0x3a17('0x14')](_0x283428);if(this[_0x3a17('0x30')]instanceof _0x1388ea){const _0x394386=this[_0x3a17('0x30')]['config']['get'](_0x3a17('0x35')),_0x217acb=this[_0x3a17('0x30')][_0x3a17('0x7')][_0x3a17('0xa')](_0x36a146);_0x217acb['unregister'](_0x394386);const _0x362a87=await this['_services']['get'](_0x394386)['getConnectedSessions']();_0x217acb['register'](_0x394386,_0x362a87);}}async[_0x3a17('0x14')](_0x51b006){const {connection:_0x3bd6b9}=this['context'][_0x3a17('0x7')][_0x3a17('0xa')](_0x5520ec),_0x5cb70e=this[_0x3a17('0x30')][_0x3a17('0x7')][_0x3a17('0xa')](_0x3a17('0x12')),_0x108cc2=this[_0x3a17('0x1e')][_0x3a17('0xa')](_0x51b006),_0x1080ef=await _0x108cc2[_0x3a17('0x18')](_0x3bd6b9);await this[_0x3a17('0xc')](_0x1080ef);const _0x3b5891=new Set(Array[_0x3a17('0x25')](_0x5cb70e['getCommentThreads']({'channelId':_0x51b006}),_0x10fab1=>_0x10fab1['id']));for(const _0x2576a of _0x1080ef)_0x3b5891['delete'](_0x2576a[_0x3a17('0x5')]);for(const _0x3ef43d of _0x3b5891)_0x5cb70e[_0x3a17('0x4')](_0x3ef43d)[_0x3a17('0x13')]({'isFromAdapter':!0x0});for(const _0x410159 of _0x1080ef){let _0x88e8a=_0x5cb70e[_0x3a17('0x4')](_0x410159['commentThreadId']);_0x88e8a||(_0x88e8a=_0x5cb70e[_0x3a17('0x1')]({'channelId':_0x51b006,'threadId':_0x410159[_0x3a17('0x5')],'isFromAdapter':!0x0}));const _0x2219a4=new Set(Array['from'](_0x88e8a[_0x3a17('0x15')],_0x4fd7b5=>_0x4fd7b5['id']));for(const _0x54fc24 of _0x410159['comments'])_0x2219a4['delete'](_0x54fc24[_0x3a17('0xe')]);for(const _0x3bfd43 of _0x2219a4)_0x88e8a['getComment'](_0x3bfd43)[_0x3a17('0x13')]({'isFromAdapter':!0x0});for(const _0x5d462e of _0x410159[_0x3a17('0x15')]){const _0x1f7290=_0x88e8a['getComment'](_0x5d462e[_0x3a17('0xe')]);_0x1f7290?_0x1f7290['content']!==_0x5d462e['content']&&_0x1f7290[_0x3a17('0x22')]({'content':_0x5d462e['content'],'isFromAdapter':!0x0}):_0x88e8a[_0x3a17('0x11')](Object[_0x3a17('0x2a')](T(_0x5d462e),{'isFromAdapter':!0x0}));}}}['_getService'](_0xa68feb){if(!this['_services'][_0x3a17('0x9')](_0xa68feb))throw new _0x51cbc1('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0xa68feb});return this['_services'][_0x3a17('0xa')](_0xa68feb);}async['_fetchMissingUsersForThreads'](_0x3eedba){const _0xb91e8d=this[_0x3a17('0x30')][_0x3a17('0x7')][_0x3a17('0xa')](_0x53a40a),{connection:_0x51126a}=this[_0x3a17('0x30')][_0x3a17('0x7')][_0x3a17('0xa')](_0x5520ec),_0x17c356=new Set();for(const {comments:_0x3f806d}of _0x3eedba)for(const {userId:_0x141cf2}of _0x3f806d)_0xb91e8d['getUser'](_0x141cf2)||_0x17c356[_0x3a17('0x37')](_0x141cf2);if(0x0===_0x17c356[_0x3a17('0x2')])return;const _0x3d0ce3=await _0x33a86f['getMany'](_0x51126a,Array['from'](_0x17c356));for(const _0x496970 of _0x3d0ce3)_0xb91e8d[_0x3a17('0x10')](_0x496970['id'])||_0xb91e8d[_0x3a17('0x27')](_0x496970);}}async function S(_0x5058d7){if(_0x3a17('0x3')!==_0x5058d7['code'])throw _0x5058d7;}function R(_0x41a4f3){if((_0x1927ac=_0x41a4f3)[_0x3a17('0x1a')][_0x3a17('0x28')](_0x3a17('0x34'))||_0x1927ac[_0x3a17('0x1a')][_0x3a17('0x28')](_0x3a17('0x29'))||_0x1927ac[_0x3a17('0x1a')]['startsWith'](_0x3a17('0x1d')))return new Promise(()=>{});var _0x1927ac;throw _0x41a4f3;}function T(_0x1484ff){return{'threadId':_0x1484ff[_0x3a17('0x5')],'commentId':_0x1484ff[_0x3a17('0xe')],'content':_0x1484ff[_0x3a17('0x26')],'createdAt':_0x1484ff[_0x3a17('0x2e')],'authorId':_0x1484ff[_0x3a17('0x17')],'attributes':_0x1484ff['attributes']};}a['CommentsService']=_0x5cefd8;