/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x2370=['init','sessions-register-already-registered','getUserSessions','context','connection','assign','set','requires','_users','remove','_handleSessionAdd','add','delete','addUser','pluginName','role','sessionAdd:','size','values','user','getUser','_registeredSessions','_handleSessionRemove','has','_uniqueUsersCount','defineMe','connected','allConnectedUsers','get','clear','_createUser','channelSessions','unregister','Sessions','channelConnectedUsers','state','plugins','register','stopListening','change:state','sessionId'];(function(_0x1da98f,_0x237020){const _0x34fc64=function(_0x30be16){while(--_0x30be16){_0x1da98f['push'](_0x1da98f['shift']());}};_0x34fc64(++_0x237020);}(_0x2370,0xe0));const _0x34fc=function(_0x1da98f,_0x237020){_0x1da98f=_0x1da98f-0x0;let _0x34fc64=_0x2370[_0x1da98f];return _0x34fc64;};import{ContextPlugin as _0x381f2d}from'ckeditor5/src/core';import{Collection as _0x54a53a,CKEditorError as _0xd02b3e}from'ckeditor5/src/utils';import _0x6b0d1d from'./websocketgateway';import{Users as _0x16fa4d}from'ckeditor5-collaboration/src/collaboration-core';export default class r extends _0x381f2d{static get[_0x34fc('0x24')](){return _0x34fc('0xe');}static get[_0x34fc('0x1d')](){return[_0x6b0d1d,_0x16fa4d];}[_0x34fc('0x16')](){const _0x1fdcf4=this[_0x34fc('0x19')],_0x59002c=_0x1fdcf4[_0x34fc('0x11')][_0x34fc('0x9')](_0x6b0d1d);this['channelSessions']=new Map(),this[_0x34fc('0xf')]=new Map(),this[_0x34fc('0x8')]=new _0x54a53a(),this[_0x34fc('0x2')]=new Map(),this['_uniqueUsersCount']=0x0,this[_0x34fc('0x1e')]=_0x1fdcf4[_0x34fc('0x11')]['get'](_0x16fa4d),this['listenTo'](_0x59002c,_0x34fc('0x14'),(_0x2907c4,_0x1cc60f,_0x529c8e)=>{if(_0x34fc('0x7')!==_0x529c8e)this[_0x34fc('0xc')]['forEach'](_0x49d051=>_0x49d051[_0x34fc('0xa')]()),this['channelConnectedUsers']['forEach'](_0x3bf0a2=>_0x3bf0a2[_0x34fc('0xa')]()),this[_0x34fc('0x8')][_0x34fc('0xa')]();else for(const [_0x51575c,_0x41dfa5]of this['_registeredSessions'])for(const _0x200326 of _0x41dfa5)this[_0x34fc('0x20')](_0x51575c,_0x200326);}),this[_0x34fc('0xb')](_0x59002c['connection']['me'],!0x0);}[_0x34fc('0x12')](_0x2d0c16,_0x104d96){if(this[_0x34fc('0x2')][_0x34fc('0x4')](_0x2d0c16))throw new _0xd02b3e(_0x34fc('0x17'),null,{'channelId':_0x2d0c16});this[_0x34fc('0x2')][_0x34fc('0x1c')](_0x2d0c16,_0x104d96),this[_0x34fc('0xc')][_0x34fc('0x1c')](_0x2d0c16,new _0x54a53a()),this[_0x34fc('0xf')][_0x34fc('0x1c')](_0x2d0c16,new _0x54a53a()),this['listenTo'](_0x104d96,'add',(_0x2ad59a,_0x693d08)=>this['_handleSessionAdd'](_0x2d0c16,_0x693d08)),this['listenTo'](_0x104d96,'remove',(_0x2a9ee9,_0x214adb)=>this[_0x34fc('0x3')](_0x2d0c16,_0x214adb));for(const _0x5e3423 of _0x104d96)this[_0x34fc('0x20')](_0x2d0c16,_0x5e3423);}[_0x34fc('0xd')](_0x558745){if(!this[_0x34fc('0x2')]['has'](_0x558745))throw new _0xd02b3e('sessions-unregister-not-exist',null,{'channelId':_0x558745});const _0x13e85e=this[_0x34fc('0x2')][_0x34fc('0x9')](_0x558745);this[_0x34fc('0x13')](_0x13e85e);for(const _0x6992c3 of _0x13e85e)_0x34fc('0x7')===this[_0x34fc('0x19')]['plugins'][_0x34fc('0x9')](_0x6b0d1d)[_0x34fc('0x10')]&&this['_handleSessionRemove'](_0x558745,_0x6992c3);this[_0x34fc('0x2')][_0x34fc('0x22')](_0x558745),this[_0x34fc('0xc')]['delete'](_0x558745),this[_0x34fc('0xf')]['delete'](_0x558745);}get['mySessionId'](){return this[_0x34fc('0x19')][_0x34fc('0x11')][_0x34fc('0x9')](_0x6b0d1d)[_0x34fc('0x1a')][_0x34fc('0x15')];}['getUserBySessionId'](_0x598aa7){for(const _0x134ef4 of this[_0x34fc('0xc')]['values']())for(const _0x59ecf9 of _0x134ef4)if(_0x59ecf9['id']===_0x598aa7)return _0x59ecf9[_0x34fc('0x0')];}[_0x34fc('0x18')](_0xada958,_0xac3278){const _0x38895f=_0xac3278?[this[_0x34fc('0xc')][_0x34fc('0x9')](_0xac3278)]:this['channelSessions'][_0x34fc('0x28')](),_0x45cbd0=new Set();for(const _0x4270da of _0x38895f)for(const _0x3ec1ce of _0x4270da)_0x3ec1ce[_0x34fc('0x0')]['id']===_0xada958['id']&&_0x45cbd0[_0x34fc('0x21')](_0x3ec1ce['id']);return _0x45cbd0;}['getUserRole'](_0x1b5045){for(const _0x54d75d of this[_0x34fc('0xc')][_0x34fc('0x28')]())for(const _0x435c27 of _0x54d75d)if(_0x435c27['user']===_0x1b5045)return _0x435c27[_0x34fc('0x25')];}[_0x34fc('0x20')](_0x163e41,_0x201fc0){if(_0x34fc('0x7')!==this[_0x34fc('0x19')]['plugins'][_0x34fc('0x9')](_0x6b0d1d)[_0x34fc('0x10')])return;const _0x1a0d33=_0x201fc0[_0x34fc('0x0')],_0xe22f0=this['_users'][_0x34fc('0x1')](_0x1a0d33['id'])||this[_0x34fc('0xb')](_0x1a0d33),_0x7113ff=Object[_0x34fc('0x1b')]({},_0x201fc0,{'user':_0xe22f0});this['channelSessions'][_0x34fc('0x9')](_0x163e41)['add'](_0x7113ff);const _0x3f8ad9=this['channelConnectedUsers'][_0x34fc('0x9')](_0x163e41);_0x3f8ad9[_0x34fc('0x4')](_0xe22f0['id'])||_0x3f8ad9[_0x34fc('0x21')](_0xe22f0),this[_0x34fc('0x8')]['has'](_0xe22f0['id'])||this[_0x34fc('0x8')][_0x34fc('0x21')](_0xe22f0),this['fire'](_0x34fc('0x26')+_0x163e41,{'channelId':_0x163e41,'session':_0x7113ff});}['_handleSessionRemove'](_0x170172,_0x5f448a){if(_0x34fc('0x7')!==this[_0x34fc('0x19')][_0x34fc('0x11')][_0x34fc('0x9')](_0x6b0d1d)[_0x34fc('0x10')])return;const _0x276efc=this[_0x34fc('0xf')]['get'](_0x170172),_0x1c3ad2=_0x5f448a[_0x34fc('0x0')];this['channelSessions'][_0x34fc('0x9')](_0x170172)[_0x34fc('0x1f')](_0x5f448a['id']),_0x276efc[_0x34fc('0x4')](_0x1c3ad2['id'])&&!this['getUserSessions'](_0x1c3ad2,_0x170172)[_0x34fc('0x27')]&&_0x276efc[_0x34fc('0x1f')](_0x1c3ad2['id']),this['allConnectedUsers']['get'](_0x1c3ad2['id'])&&!this[_0x34fc('0x18')](_0x1c3ad2)[_0x34fc('0x27')]&&this['allConnectedUsers'][_0x34fc('0x1f')](_0x1c3ad2['id']);}[_0x34fc('0xb')](_0x4dc421,_0xf694aa){const _0x359525=this[_0x34fc('0x1e')][_0x34fc('0x23')](_0x4dc421);return _0xf694aa&&this['_users'][_0x34fc('0x6')](_0x4dc421['id']),_0x359525['orderNumber']=this[_0x34fc('0x5')]++,_0x359525;}}