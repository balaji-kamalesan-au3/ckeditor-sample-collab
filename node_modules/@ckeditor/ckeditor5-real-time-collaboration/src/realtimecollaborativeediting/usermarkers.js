/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x384f=['isLimit','change','editing','user:range','schema','getRange','for','fromRange','createUserMarkerOperations','model','hasContent','markerRange','requires','hasDomSelection','startsWith','markerName','isInline','&#8203;<span\x20class=\x22ck-user__marker-line\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span>','ck-user__selection','user:position:','innerHTML','isCollapsed','contenteditable','createRange','setCustomProperty','markerToElement','pluginName','user:position','getAttribute','type','undo','newRange','getSelectionClass','getUserBySessionId','tableCell','color','user:','start','checkChild','isObject','get','addMarker','removeMarker','createUIElement','set','UserMarkers','init','change:range','marker','end','getStart','mySessionId','userPositionMarker','commands','isSimilar','getFirstRange','element','getNearestSelectionRange','deletionPosition','document','priority','updateMarker','applyOperation','_createdBatches','plugins','afterInit','view','editor','size','selection','getCustomProperty','split','getMarkerClass','span','data-session-id','highest','clear','batch','detach','name','update:user:range','toRange','markers','$graveyard','user:range:','orderNumber','editingDowncast','has','enqueueChange','toDomElement','root','conversion','reconvertMarker','rootName','oldRange'];(function(_0x2de5f9,_0x384f14){const _0x119a94=function(_0x4ba0ea){while(--_0x4ba0ea){_0x2de5f9['push'](_0x2de5f9['shift']());}};_0x119a94(++_0x384f14);}(_0x384f,0x124));const _0x119a=function(_0x2de5f9,_0x384f14){_0x2de5f9=_0x2de5f9-0x0;let _0x119a94=_0x384f[_0x2de5f9];return _0x119a94;};import{Plugin as _0x30683a}from'ckeditor5/src/core';import _0x5b6c1f from'./sessions';import{LiveRange as _0x26521a}from'ckeditor5/src/engine';import'../../theme/usermarkers.css';export default class V extends _0x30683a{static get[_0x119a('0x5')](){return[_0x5b6c1f];}static get[_0x119a('0x13')](){return _0x119a('0x26');}[_0x119a('0x27')](){const _0x31c97a=this[_0x119a('0x3c')],_0x57eaf6=_0x31c97a[_0x119a('0x39')][_0x119a('0x21')](_0x5b6c1f);_0x31c97a[_0x119a('0x54')][_0x119a('0x5e')](_0x119a('0x4f'))[_0x119a('0x12')]({'model':_0x119a('0x14'),'view':(_0xf9a2fa,{writer:_0x4a22e9})=>function(_0x33b32d,_0x37bd9c,_0x50599d,_0x565501){const _0x3e8fe0=_0x33b32d[_0x119a('0x8')][_0x119a('0x40')](':')[0x2],_0x648c3a=_0x50599d[_0x119a('0x1a')](_0x3e8fe0);if(!_0x648c3a||_0x3e8fe0===_0x50599d[_0x119a('0x2c')])return;if(!_0x565501[_0x119a('0x2')][_0x119a('0x5c')][_0x119a('0x1f')](_0x33b32d[_0x119a('0x4')][_0x119a('0x1e')],'$text'))return;const _0x47b7a7={'class':'ck-user__marker\x20'+_0x648c3a[_0x119a('0x1c')][_0x119a('0x41')](),'data-name':_0x648c3a[_0x119a('0x48')],'data-session-id':_0x3e8fe0},_0x118e71=_0x565501['model']['markers'][_0x119a('0x21')](_0x33b32d[_0x119a('0x8')])[_0x119a('0x2b')](),_0x11c684=_0x118e71['nodeAfter'],_0x2bd075=_0x565501[_0x119a('0x2')][_0x119a('0x5c')];if(_0x11c684&&_0x2bd075[_0x119a('0x20')](_0x11c684)&&_0x2bd075[_0x119a('0x9')](_0x11c684)&&!_0x565501['model'][_0x119a('0x4b')][_0x119a('0x21')]('user:range:'+_0x3e8fe0)[_0x119a('0x5d')]()[_0x119a('0xe')])return;const _0x34fc78=_0x118e71['parent'];_0x565501['model'][_0x119a('0x5c')][_0x119a('0x58')](_0x34fc78)&&!_0x565501[_0x119a('0x2')][_0x119a('0x3')](_0x34fc78)&&(_0x47b7a7[_0x119a('0xf')]=!0x1);const _0x2293ed=function(_0x384cfb,_0x37da8f){const _0x502fe3=_0x384cfb[_0x119a('0x24')](_0x119a('0x42'),_0x37da8f);return _0x384cfb[_0x119a('0x11')](_0x119a('0x2d'),!0x0,_0x502fe3),_0x502fe3['render']=function(_0x22e317){const _0x4589a5=this[_0x119a('0x52')](_0x22e317);return _0x4589a5[_0x119a('0xd')]=_0x119a('0xa'),_0x4589a5;},_0x502fe3[_0x119a('0x2f')]=function(_0x44343e){return this[_0x119a('0x3f')](_0x119a('0x2d'))&&_0x44343e['getCustomProperty']('userPositionMarker')&&this[_0x119a('0x15')](_0x119a('0x43'))==_0x44343e[_0x119a('0x15')](_0x119a('0x43'));},_0x502fe3;}(_0x37bd9c,_0x47b7a7);return _0x2293ed[_0x119a('0x35')]=0x3e8+_0x648c3a[_0x119a('0x4e')],_0x2293ed;}(_0xf9a2fa,_0x4a22e9,_0x57eaf6,_0x31c97a)}),_0x31c97a[_0x119a('0x54')][_0x119a('0x5e')](_0x119a('0x4f'))['markerToHighlight']({'model':_0x119a('0x5b'),'view':_0x5ef79d=>function(_0x1d91e5,_0x23c06b){const _0x304e4e=_0x1d91e5[_0x119a('0x8')][_0x119a('0x40')](':')[0x2];if(_0x304e4e===_0x23c06b[_0x119a('0x2c')])return;const _0x13b7d6=_0x23c06b[_0x119a('0x1a')](_0x304e4e);if(!_0x13b7d6)return{'id':_0x304e4e};return{'id':_0x304e4e,'classes':[_0x119a('0xb'),_0x13b7d6[_0x119a('0x1c')][_0x119a('0x19')]()],'attributes':{'data-session-id':_0x304e4e},'priority':0x7d0+_0x13b7d6[_0x119a('0x4e')]};}(_0x5ef79d,_0x57eaf6)}),function(_0x1fe9e2){const _0x2d1094=_0x1fe9e2[_0x119a('0x2')],_0x87548d=new Map(),_0xaf27c1=_0x1fe9e2[_0x119a('0x39')]['get'](_0x5b6c1f);_0x2d1094[_0x119a('0x4b')]['on'](_0x119a('0x49'),(_0x33dae2,_0x59ad9e,_0x4642f3,_0x10ac23)=>{if(!_0x10ac23&&_0x87548d[_0x119a('0x21')](_0x59ad9e[_0x119a('0x48')]))return _0x87548d[_0x119a('0x21')](_0x59ad9e[_0x119a('0x48')])[_0x119a('0x47')](),void _0x87548d['delete'](_0x59ad9e['name']);const _0x157e45=_0x59ad9e[_0x119a('0x48')][_0x119a('0x40')](':')[0x2];if(_0x157e45===_0xaf27c1[_0x119a('0x2c')])return;const _0x4e73e4='user:position:'+_0x157e45;_0x2d1094['markers'][_0x119a('0x50')](_0x4e73e4)&&_0x1fe9e2[_0x119a('0x5a')][_0x119a('0x55')](_0x4e73e4),_0x59ad9e['on']('change:range',(_0x8810d7,_0x495392,_0x37ed54)=>{if(_0x119a('0x4c')!=_0x495392[_0x119a('0x53')][_0x119a('0x56')]&&_0x119a('0x4c')==_0x59ad9e[_0x119a('0x5d')]()[_0x119a('0x53')][_0x119a('0x56')]&&!_0x87548d[_0x119a('0x50')](_0x59ad9e[_0x119a('0x48')])){const _0x590a12=_0x2d1094[_0x119a('0x5c')][_0x119a('0x32')](_0x37ed54['deletionPosition']);if(_0x590a12){const _0x2446e6=_0x26521a[_0x119a('0x0')](_0x590a12);_0x87548d[_0x119a('0x25')](_0x59ad9e[_0x119a('0x48')],_0x2446e6),_0x2446e6['on'](_0x119a('0x28'),(_0x4a24ba,_0x3fc77d,_0x5beb66)=>{if('$graveyard'==_0x2446e6[_0x119a('0x53')][_0x119a('0x56')]){const _0x1b1bb2=_0x2d1094[_0x119a('0x5c')][_0x119a('0x32')](_0x5beb66[_0x119a('0x33')]);_0x1b1bb2?(_0x2446e6[_0x119a('0x1e')]=_0x1b1bb2['start'],_0x2446e6[_0x119a('0x2a')]=_0x1b1bb2[_0x119a('0x2a')]):(_0x87548d['delete'](_0x59ad9e[_0x119a('0x48')]),_0x2446e6['detach']());}});}}});}),_0x2d1094['document']['on'](_0x119a('0x59'),()=>{_0x87548d[_0x119a('0x3d')]>0x0&&_0x2d1094[_0x119a('0x51')]({'isUndoable':!0x1},_0xc67f5a=>{for(const [_0x427fa2,_0x2ee479]of _0x87548d)_0x119a('0x4c')==_0x2d1094[_0x119a('0x4b')][_0x119a('0x21')](_0x427fa2)[_0x119a('0x5d')]()[_0x119a('0x53')][_0x119a('0x56')]&&(Q(_0x427fa2['split'](':')[0x2],_0x2ee479[_0x119a('0x4a')](),_0x2d1094,_0xc67f5a),_0x2ee479[_0x119a('0x47')]());_0x87548d[_0x119a('0x45')]();});});}(_0x31c97a);}[_0x119a('0x3a')](){const _0x3faedb=this[_0x119a('0x3c')],_0x236af7=_0x3faedb[_0x119a('0x2e')][_0x119a('0x21')](_0x119a('0x17'));_0x236af7&&_0x3faedb[_0x119a('0x2')]['on'](_0x119a('0x37'),(_0x463523,_0x3b6197)=>{const _0x3d523a=_0x3b6197[0x0];if(_0x119a('0x29')!=_0x3d523a[_0x119a('0x16')]||!_0x3d523a['name'][_0x119a('0x7')](_0x119a('0x1d')))return;const _0x80c10a=_0x3d523a[_0x119a('0x46')];_0x236af7[_0x119a('0x38')]['has'](_0x80c10a)&&(_0x3d523a[_0x119a('0x18')]=_0x3d523a[_0x119a('0x57')]?_0x3faedb[_0x119a('0x2')][_0x119a('0x10')](_0x3d523a[_0x119a('0x57')]['start'],_0x3d523a[_0x119a('0x57')][_0x119a('0x2a')]):null);},{'priority':_0x119a('0x44')});}[_0x119a('0x1')](){const _0x19ec97=this['editor'],_0x2b8e2d=_0x19ec97[_0x119a('0x2')][_0x119a('0x34')],_0x583a51=_0x19ec97[_0x119a('0x39')][_0x119a('0x21')](_0x5b6c1f);_0x19ec97[_0x119a('0x2')][_0x119a('0x51')]({'isUndoable':!0x1},_0x5197b1=>{const _0x133a86=_0x119a('0x4d')+_0x583a51[_0x119a('0x2c')],_0x35528d=_0x119a('0xc')+_0x583a51[_0x119a('0x2c')],_0x4939b4=_0x19ec97[_0x119a('0x2')][_0x119a('0x4b')]['has'](_0x133a86);_0x19ec97[_0x119a('0x5a')][_0x119a('0x3b')][_0x119a('0x6')]?Q(_0x583a51[_0x119a('0x2c')],_0x2b8e2d[_0x119a('0x3e')][_0x119a('0x30')](),_0x19ec97[_0x119a('0x2')],_0x5197b1):_0x4939b4&&(_0x5197b1[_0x119a('0x23')](_0x133a86),_0x5197b1[_0x119a('0x23')](_0x35528d));});}}function Q(_0x3546e6,_0x460d7b,_0x5db375,_0x469962){const _0x1ad86c=_0x119a('0x4d')+_0x3546e6,_0x240fbd=_0x119a('0xc')+_0x3546e6,_0x3a9da0=_0x460d7b['getContainedElement']();let _0x46ca29=_0x460d7b['start'];_0x3a9da0&&_0x3a9da0['is'](_0x119a('0x31'),_0x119a('0x1b'))&&(_0x46ca29=function(_0x29324f,_0x3fe9de){for(const _0x9a5054 of _0x29324f['getPositions']())if(_0x3fe9de['schema']['checkChild'](_0x9a5054,'$text'))return _0x9a5054;}(_0x460d7b,_0x5db375),_0x460d7b=_0x469962[_0x119a('0x10')](_0x46ca29)),_0x46ca29=_0x469962[_0x119a('0x10')](_0x46ca29),_0x5db375[_0x119a('0x4b')]['has'](_0x1ad86c)?(_0x469962[_0x119a('0x36')](_0x1ad86c,{'range':_0x460d7b}),_0x469962[_0x119a('0x36')](_0x240fbd,{'range':_0x46ca29})):(_0x469962['addMarker'](_0x1ad86c,{'range':_0x460d7b,'usingOperation':!0x0}),_0x469962[_0x119a('0x22')](_0x240fbd,{'range':_0x46ca29,'usingOperation':!0x0}));}