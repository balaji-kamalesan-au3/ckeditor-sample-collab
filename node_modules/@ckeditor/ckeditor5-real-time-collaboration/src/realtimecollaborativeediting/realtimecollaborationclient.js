/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x2ac2=['_setPendingAction','_handleInitialConnectionData','getConnectedSessions','_clearPendingAction','_saveOperationInBuffer','_initSessionsHandling','locale','_operationToId','_lastServerVersion','connected','change:range','wasUndone','real-time-collaboration','_pendingAction','409','push','lastDocumentSession','editor','sessionId','addUser','_compressOperations','The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','roots','define','startsWith','disconnect','_sendBufferedOperationsDelayed','realtimecollaborationclient-initservice-internal-error','type','keys','suppressErrorInCollaboration','high','_setUpDataInit','realtimecollaborationclient-sendbufferedoperations','serverHistory','_updateServerHistory','RealTimeCollaborationClient','getOperationAuthor','slice','change:_isEditingAllowed','_compressor','getOperations','model','compress','size','_isPendingUpdate','stop','_handleReconnectionError','unregister','has','destroy','_service','_authorId','collaboration-missing-channelid','addToReconnectionStack','initData','rtc-destroyed','_operationIdentifier','_offset','sendOperations','_currentBufferDelay','map','disconnected','error','_handleReceivedOperations','decompress','_isEditingAllowed','realtimecollaborationclient-init-non-existent-root','currentDocumentSession','_ignoredOperations','requires','The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','connection','_handleExternalOperations','view','reset','userId','_channelId','data','sessionAdd:','document','baseVersion','_initThrowingOnDataSet','editing','_decompressOperations','pluginName','getMany','_assignOperationsMetaData','remove','return','code','init','_hasSynchronizationProblem','listenTo','showWarning','realtimecollaborationclient-init-document-already-initialized','_sendBufferedOperationsDelayId','permissions','wereChangesApplied','apply','404','fromJSON','register','finally','_getOperationsFromInitData','cloudDocumentVersion','message','isUndoneOperation','isDocumentOperation','_knownOperations','_disconnectService','The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','reconnection:\x20flushed\x20session','CollaborativeEditingService','realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration','add','createdAt','createUserMarkerOperations','markers','_isConnected','length','realtimecollaborationclient-initservice-incorrect-server-operation','getUser','path','reconnect','isEnabled','setIdForTheLastOperation','metadata','applyOperation','offset','operationsReceived','_handleServerResponse','ready','round','removeFromReconnectionStack','from','realtimecollaborationclient-handleserverresponse','state','getIdOfTheLastOperation','_connectAfterSessionHasBeenFlushed','lastSyncVersion','set','_crash','catch','parse','createPositionAt','history','_shouldSendSelectionUpdate','rtc-offline','_shouldSendUpdate','forEach','_handleSendingSelectionMarkers','off','cloud-services-internal-error:\x20Request\x20timeout.','_connectService','start','end','realtimecollaborationclient-init-session-connection-error','marker','channelSessions','_document','toJSON','CommentsOnly','_hasSelectionChanged','_applyOperationsSet','_isDisconnection','_sendBufferedOperations','plugins','_bufferedOperations','_baseBufferDelay','setPermissions','enqueueChange','bind','isReadOnly','selection','filter','Synchronization\x20issue','The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','fire','version','get','change:hasDomSelection','createRange','_isInit','realtimecollaborationclient-init-connection-failed','_lastSyncedOperationId','addOperation','enableReadOnlyMode','then','_fetchMissingUsers','lastOperationId','collaboration.channelId','_disconnectionOperations','_refreshUserSelectionMarkers','disableReadOnlyMode','batch','sessionCreatedAt','config'];(function(_0x3dbbe2,_0x2ac269){const _0x232d4f=function(_0x54e5ef){while(--_0x54e5ef){_0x3dbbe2['push'](_0x3dbbe2['shift']());}};_0x232d4f(++_0x2ac269);}(_0x2ac2,0x167));const _0x232d=function(_0x3dbbe2,_0x2ac269){_0x3dbbe2=_0x3dbbe2-0x0;let _0x232d4f=_0x2ac2[_0x3dbbe2];return _0x232d4f;};import{Plugin as _0x9078cf,PendingActions as _0x18d1d0}from'ckeditor5/src/core';import{CKEditorError as _0x16b250,version as _0x50ad65,uid as _0x115524}from'ckeditor5/src/utils';import{transformSets as _0x37a4ac,InsertOperation as _0x13a5e7,MarkerOperation as _0x219d5b,OperationFactory as _0x569651,History as _0x3ac5c1}from'ckeditor5/src/engine';import{Notification as _0x4bd74f}from'ckeditor5/src/ui';import{Users as _0x22b08a}from'ckeditor5-collaboration/src/collaboration-core';import _0xea8865 from'./websocketgateway';import _0x387cc9 from'./sessions';import _0x53ba97 from'./usermarkers';import{getTranslation as _0x51195c}from'../common-translations';import _0x26be5d from'@ckeditor/ckeditor5-operations-compressor/src/compressor';import _0x59be25 from'@ckeditor/ckeditor-cloud-services-collaboration/src/collaborativeeditingservice/collaborativeeditingservice';import _0x1c3470 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';let G=0x1;export default class l extends _0x9078cf{static get[_0x232d('0x6b')](){return[_0xea8865,_0x387cc9,_0x53ba97,_0x18d1d0,_0x22b08a,_0x4bd74f];}static get[_0x232d('0x7a')](){return _0x232d('0x49');}get[_0x232d('0x8e')](){return this[_0x232d('0x2d')]+this['_offset'];}get[_0x232d('0x2d')](){return this[_0x232d('0x47')]['version']-this[_0x232d('0x5f')];}get[_0x232d('0xb1')](){const _0x364d65=this[_0x232d('0x47')][_0x232d('0x4e')]();for(let _0x3295b9=_0x364d65[_0x232d('0x9d')]-0x1;_0x3295b9>=0x0;_0x3295b9--){const _0x1a56ca=_0x364d65[_0x3295b9];if(!this[_0x232d('0x1f')][_0x232d('0x56')](_0x1a56ca))return _0x1a56ca[_0x232d('0x76')]+0x1-this[_0x232d('0x5f')];}return 0x0;}[_0x232d('0x80')](){const _0x134e17=this[_0x232d('0x36')],_0x3bdab9=_0x134e17['plugins'][_0x232d('0x13')](_0x22b08a),_0x259141=_0x134e17[_0x232d('0x6')][_0x232d('0x13')](_0xea8865);if(this[_0x232d('0x5f')]=0x0,this[_0x232d('0x37')]=null,this[_0x232d('0x47')]=new _0x3ac5c1(),this[_0x232d('0x36')][_0x232d('0x24')][_0x232d('0x3c')]('collaboration',{}),this[_0x232d('0x72')]=_0x134e17[_0x232d('0x24')][_0x232d('0x13')](_0x232d('0x1e')),!this[_0x232d('0x72')])throw new _0x16b250(_0x232d('0x5a'),this);this[_0x232d('0x82')](_0x3bdab9,_0x232d('0x4a'),(_0x3a60fe,_0x3a0aad)=>{const _0x346124=_0x3a0aad[0x0];_0x346124[_0x232d('0x59')]&&(_0x3a60fe[_0x232d('0x7e')]=_0x3bdab9[_0x232d('0x9f')](_0x346124['_authorId']),_0x3a60fe['stop']()),null===_0x346124[_0x232d('0x59')]&&(_0x3a60fe['return']=null,_0x3a60fe[_0x232d('0x53')]());},{'priority':_0x232d('0x44')});const _0x4ebf80=_0x134e17[_0x232d('0x24')]['get']('cloudServices.bundleVersion')||_0x50ad65;this['_service']=new l[(_0x232d('0x96'))](_0x4ebf80,this['_channelId']),this[_0x232d('0xc5')]=this[_0x232d('0x36')][_0x232d('0x4f')][_0x232d('0x75')],this[_0x232d('0x4d')]=new _0x26be5d(),this[_0x232d('0x7')]=[],this[_0x232d('0x92')]=new WeakSet(),this[_0x232d('0xb2')](_0x232d('0x52'),!0x1),this[_0x232d('0xb2')](_0x232d('0x81'),!0x1),this[_0x232d('0x32')]=null,this['_hasSelectionChanged']=!0x1,this[_0x232d('0x85')]=null,this['_baseBufferDelay']=0x12c,this[_0x232d('0x61')]=this[_0x232d('0x8')],this[_0x232d('0x18')]=null,this[_0x232d('0x1f')]=new WeakSet(),this['_operationIdentifier']=new K(this[_0x232d('0x1f')]),this[_0x232d('0x82')](_0x134e17['model'][_0x232d('0x75')][_0x232d('0xd')],_0x232d('0x2f'),(_0x588c3a,_0x5c7067)=>{_0x5c7067['directChange']&&this[_0x232d('0x20')]();}),this[_0x232d('0x82')](_0x134e17[_0x232d('0x78')][_0x232d('0x6f')],_0x232d('0x14'),()=>{this[_0x232d('0x20')]();}),this['_initThrowingOnDataSet'](),_0x134e17['model']['on']('applyOperation',(_0x4634fa,_0x971720)=>{const _0x2ae9e9=_0x971720[0x0];_0x2ae9e9[_0x232d('0x91')]&&(this[_0x232d('0x29')](_0x2ae9e9),this['_shouldSendUpdate']()&&this[_0x232d('0x3f')]());}),this['_setUpDataInit'](),this[_0x232d('0xb')]('_isEditingAllowed')['to'](_0x259141,_0x232d('0xae'),this,'_hasSynchronizationProblem',(_0x435361,_0x365c30)=>_0x232d('0x2e')===_0x435361&&!_0x365c30),this['on'](_0x232d('0x4c'),()=>{this[_0x232d('0x67')]?_0x134e17[_0x232d('0x21')](_0x232d('0xb9')):_0x134e17[_0x232d('0x1a')](_0x232d('0xb9'));}),this[_0x232d('0x67')]?_0x134e17[_0x232d('0x21')]('rtc-offline'):_0x134e17[_0x232d('0x1a')](_0x232d('0xb9')),this['set'](_0x232d('0x9c'),!0x1);}async[_0x232d('0xa1')](){const _0x5814ee=this[_0x232d('0x36')][_0x232d('0x6')][_0x232d('0x13')](_0x387cc9),_0x5c60bb=this['editor'][_0x232d('0x6')]['get'](_0xea8865);try{this[_0x232d('0x52')]=!0x0,_0x5814ee[_0x232d('0x55')](this[_0x232d('0x72')]);const _0x1d1aa4=await this[_0x232d('0x58')]['reconnect'](_0x5c60bb[_0x232d('0x6d')],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x1d1aa4)&&(this['_isPendingUpdate']=!0x1,this[_0x232d('0x28')]());const _0x38e007=await this[_0x232d('0x58')]['getConnectedSessions']();_0x5814ee['register'](this[_0x232d('0x72')],_0x38e007),this[_0x232d('0xbc')](),this[_0x232d('0x9c')]=!0x0;}catch(_0x5a98a9){if(function(_0x3d10c9){return _0x232d('0x89')===_0x3d10c9[_0x232d('0x7f')];}(_0x5a98a9)&&this[_0x232d('0x37')])await this[_0x232d('0xb0')]();else{if(function(_0x5bbf59){return _0x232d('0x33')===_0x5bbf59[_0x232d('0x7f')];}(_0x5a98a9)){const _0x387e6b=_0x51195c(this[_0x232d('0x36')]['locale'],_0x232d('0x10'));this[_0x232d('0x54')](_0x387e6b);}else{if(!(_0x5a98a9 instanceof j))throw _0x5a98a9;this['_handleReconnectionError']();}}}}[_0x232d('0x57')](){const _0x32a62c=this['editor'][_0x232d('0x6')]['get'](_0xea8865),_0x3910e5=this[_0x232d('0x36')]['plugins'][_0x232d('0x13')](_0x387cc9);this[_0x232d('0x36')][_0x232d('0x1a')](_0x232d('0x5d')),_0x3910e5[_0x232d('0xc4')][_0x232d('0x56')](this[_0x232d('0x72')])&&_0x3910e5['unregister'](this[_0x232d('0x72')]),_0x32a62c[_0x232d('0xab')](this),this[_0x232d('0x93')](),super[_0x232d('0x57')]();}async['_handleReconnectionResponse'](_0x4da016){if(this[_0x232d('0x37')]!==_0x4da016[_0x232d('0x37')]&&this['_lastSyncedOperationId']!==_0x4da016[_0x232d('0x1d')])throw new j();return this[_0x232d('0x37')]=_0x4da016[_0x232d('0x37')],this[_0x232d('0xa8')]([],{..._0x4da016,'wereChangesApplied':!0x1,'data':_0x4da016[_0x232d('0x73')]},_0x232d('0xa1'));}async[_0x232d('0xbf')](_0x361fcc,_0x6feb28=!0x1){const {connection:_0x2aa1fd}=this['editor']['plugins']['get'](_0xea8865);l[_0x232d('0x96')][_0x232d('0x27')](_0x2aa1fd,this[_0x232d('0x72')])[_0x232d('0x1b')](_0x2ea247=>this[_0x232d('0x2a')](_0x2ea247))['catch'](_0x425650=>{this[_0x232d('0xb3')](_0x232d('0xc2'),_0x425650);}),this[_0x232d('0x82')](this[_0x232d('0x58')],_0x232d('0xa7'),this['_handleReceivedOperations'][_0x232d('0xb')](this)),this['listenTo'](this[_0x232d('0x58')],_0x232d('0x64'),(_0x385315,_0x5b9d66)=>{this[_0x232d('0xb3')](_0x232d('0x40'),_0x5b9d66);}),this['listenTo'](this['_service'],_0x232d('0x63'),()=>{this[_0x232d('0x9c')]=!0x1;});const _0x219258=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x361fcc),_0x4d16c8=await this[_0x232d('0x58')]['connect'](_0x2aa1fd,this[_0x232d('0x39')](_0x361fcc),_0x219258);if(this[_0x232d('0x37')]=_0x4d16c8[_0x232d('0x37')],_0x4d16c8[_0x232d('0x87')]&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']()),_0x6feb28){if(!_0x4d16c8[_0x232d('0x87')])return void this['_handleReconnectionError']();this[_0x232d('0x47')][_0x232d('0x70')](),this['_offset']=_0x4d16c8[_0x232d('0xa6')],this['serverHistory'][_0x232d('0x12')]=this[_0x232d('0x5f')],await this[_0x232d('0xa8')](_0x361fcc,_0x4d16c8,_0x232d('0x95'));}else await this[_0x232d('0x26')](_0x4d16c8,_0x361fcc);this[_0x232d('0xbc')](),this['_isConnected']=!0x0;}[_0x232d('0xbc')](){const _0x2e13e7=this['editor'][_0x232d('0x6')][_0x232d('0x13')](_0x387cc9),_0x3e32cc=_0x2e13e7[_0x232d('0xc4')][_0x232d('0x13')](this[_0x232d('0x72')]);_0x3e32cc&&_0x3e32cc[_0x232d('0x9d')]>0x1?(this['_hasSelectionChanged']=!0x0,this[_0x232d('0x3f')]()):this[_0x232d('0x82')](_0x2e13e7,_0x232d('0x74')+this[_0x232d('0x72')],_0x1120d6=>{_0x2e13e7[_0x232d('0xc4')][_0x232d('0x13')](this[_0x232d('0x72')])[_0x232d('0x9d')]>0x1&&(this[_0x232d('0x2')]=!0x0,this[_0x232d('0x3f')](),_0x1120d6[_0x232d('0xbd')]());});}async[_0x232d('0x65')](_0x158c67,_0x518f99,_0x2d5315,_0x88bec6){if(!this['_isPendingUpdate']&&this[_0x232d('0xc5')][_0x232d('0x12')]==_0x518f99){const _0x35ffc6=this[_0x232d('0x79')](_0x2d5315,_0x88bec6);await this[_0x232d('0x1c')](_0x35ffc6),this[_0x232d('0x6e')](_0x35ffc6,_0x518f99,_0x2d5315[_0x232d('0x1d')])||this[_0x232d('0xb3')](_0x232d('0x9e'));}}async[_0x232d('0xb0')](){this[_0x232d('0x93')]();const {locale:_0x2527f9}=this[_0x232d('0x36')];let _0x4d84fd;try{_0x4d84fd=await this[_0x232d('0x58')]['getDocumentDetails']();}catch(_0x48412c){const _0x69538c=_0x51195c(_0x2527f9,_0x232d('0x6c'));return void this[_0x232d('0x54')](_0x69538c);}const _0x538f39=_0x4d84fd[_0x232d('0x69')]||_0x4d84fd[_0x232d('0x35')];if(this[_0x232d('0x18')]===_0x538f39[_0x232d('0x1d')])await this['_connectService'](this[_0x232d('0x36')][_0x232d('0x4f')]['document'][_0x232d('0xb7')][_0x232d('0x4e')](),!0x0);else{const _0x52cd0c=_0x51195c(_0x2527f9,_0x232d('0x94'));this[_0x232d('0x54')](_0x52cd0c);}}['_disconnectService'](){this[_0x232d('0x58')][_0x232d('0x3e')](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelay']),this['stopListening'](this['_service']);}[_0x232d('0x2a')](_0x50521e){const _0x5be31e=this[_0x232d('0x36')]['plugins'][_0x232d('0x13')](_0x387cc9);this[_0x232d('0x82')](_0x5be31e,_0x232d('0x74')+this[_0x232d('0x72')],(_0x246d49,{session:_0x44ebc1})=>{if(_0x44ebc1['id']===_0x5be31e['mySessionId']){_0x246d49['off']();const _0x5c7302=this['editor'][_0x232d('0x6')][_0x232d('0x56')](_0x232d('0x1'))&&this[_0x232d('0x36')][_0x232d('0x6')][_0x232d('0x13')](_0x232d('0x1'));let _0x13234d=_0x44ebc1[_0x232d('0x86')];_0x5c7302&&_0x5c7302[_0x232d('0xa2')]&&(_0x13234d=_0x13234d['filter'](_0x599de5=>'document:write'!==_0x599de5)),this[_0x232d('0x36')][_0x232d('0x6')]['get']('Permissions')[_0x232d('0x9')](_0x13234d,this[_0x232d('0x72')]);}}),_0x5be31e[_0x232d('0x8b')](this[_0x232d('0x72')],_0x50521e);}[_0x232d('0x77')](){const _0x47e55e=this['editor']['data'][_0x232d('0xb2')];this[_0x232d('0x36')][_0x232d('0x73')][_0x232d('0xb2')]=(..._0x42f00d)=>{if(!_0x42f00d[_0x42f00d[_0x232d('0x9d')]-0x1][_0x232d('0x43')])throw new _0x16b250(_0x232d('0x97'),this);_0x47e55e[_0x232d('0x88')](this['editor']['data'],_0x42f00d);};}[_0x232d('0x45')](){this[_0x232d('0x36')][_0x232d('0x73')]['on']('init',(_0xe4527a,[_0x1ae929])=>{if(this[_0x232d('0xc5')][_0x232d('0x12')])throw new _0x16b250(_0x232d('0x84'),this);_0xe4527a[_0x232d('0x53')](),this[_0x232d('0x25')]();const _0x5d6286=this[_0x232d('0x8d')](_0x1ae929);_0xe4527a[_0x232d('0x7e')]=this['_connectService'](_0x5d6286)[_0x232d('0x1b')](()=>{this[_0x232d('0x36')][_0x232d('0x6')][_0x232d('0x13')](_0xea8865)[_0x232d('0x5b')](this),this[_0x232d('0x36')][_0x232d('0x73')][_0x232d('0x11')](_0x232d('0xa9'));})[_0x232d('0xb4')](_0x1e06ea=>this[_0x232d('0xb3')](_0x232d('0x17'),_0x1e06ea))[_0x232d('0x8c')](()=>this['_clearPendingAction']());},{'priority':_0x232d('0x44')});}async[_0x232d('0x1c')](_0x227415){const _0x54a10c=this['editor']['plugins'][_0x232d('0x13')](_0x22b08a),{connection:_0x25ae68}=this[_0x232d('0x36')]['plugins'][_0x232d('0x13')](_0xea8865),_0x284099=new Set();for(const _0x4268ae of _0x227415){const _0x36b410=_0x4268ae[_0x232d('0x59')];_0x36b410&&!_0x54a10c[_0x232d('0x9f')](_0x36b410)&&_0x284099[_0x232d('0x98')](_0x36b410);}if(0x0===_0x284099[_0x232d('0x51')])return;const _0xbd131e=await _0x1c3470[_0x232d('0x7b')](_0x25ae68,Array[_0x232d('0xac')](_0x284099));for(const _0x2ad905 of _0xbd131e)_0x54a10c[_0x232d('0x9f')](_0x2ad905['id'])||_0x54a10c[_0x232d('0x38')](_0x2ad905);}[_0x232d('0x8d')](_0x1f1abd){const _0x40f036=this[_0x232d('0x36')][_0x232d('0x4f')],_0x1411c0=[];let _0x23efbe=0x0;const _0x357881='string'==typeof _0x1f1abd?{'main':_0x1f1abd}:_0x1f1abd;for(const _0x538a13 of Object[_0x232d('0x42')](_0x357881)){if(!this['_document'][_0x232d('0x3b')]['has'](_0x538a13))throw new _0x16b250(_0x232d('0x68'),this);const _0x30776b=this[_0x232d('0x36')]['data'][_0x232d('0xb5')](_0x357881[_0x538a13]),_0x1369cf=this[_0x232d('0xc5')]['getRoot'](_0x538a13),_0x5cc2d9=new _0x13a5e7(_0x40f036[_0x232d('0xb6')](_0x1369cf,0x0),_0x30776b,_0x23efbe++);_0x1411c0[_0x232d('0x34')](_0x5cc2d9);for(const [_0x5c0950,_0x5342c7]of _0x30776b[_0x232d('0x9b')]){const _0x1d1306=_0x40f036[_0x232d('0x15')](_0x40f036['createPositionFromPath'](_0x1369cf,_0x5342c7[_0x232d('0xc0')]['path']['slice']()),_0x40f036['createPositionFromPath'](_0x1369cf,_0x5342c7[_0x232d('0xc1')][_0x232d('0xa0')]['slice']())),_0x4e42d1=new _0x219d5b(_0x5c0950,null,_0x1d1306,_0x40f036[_0x232d('0x9b')],!0x0,_0x23efbe++);_0x1411c0['push'](_0x4e42d1);}}return _0x1411c0;}async[_0x232d('0x26')](_0x7e9c11,_0xaf1816){let _0x40c69c;this[_0x232d('0x5f')]=_0x7e9c11[_0x232d('0xa6')];const _0x1fa500=_0x7e9c11['wereChangesApplied']&&!_0x7e9c11['initData'],_0x401593=_0x1fa500?0x0:_0x7e9c11[_0x232d('0x73')][_0x232d('0x76')];if(_0x1fa500)_0x40c69c=_0xaf1816,_0x40c69c['forEach'](_0x27e3ac=>{_0x27e3ac[_0x232d('0x99')]=_0x7e9c11[_0x232d('0x23')],_0x27e3ac['_isInit']=!0x0,_0x27e3ac['_authorId']=null;}),this['_applyOperationsSet'](_0x40c69c,_0x1fa500);else{if(_0x7e9c11[_0x232d('0x5c')]){const _0x4ff69b=this[_0x232d('0x8d')](_0x7e9c11['initData']);this['_document'][_0x232d('0xb7')]['version']=-_0x4ff69b[_0x232d('0x9d')],_0x4ff69b[_0x232d('0xbb')](_0x25f89e=>{_0x25f89e[_0x232d('0x76')]-=_0x4ff69b[_0x232d('0x9d')],_0x25f89e[_0x232d('0x99')]=_0x7e9c11[_0x232d('0x23')],_0x25f89e[_0x232d('0x16')]=!0x0,_0x25f89e[_0x232d('0x59')]=null;}),this['_applyOperationsSet'](_0x4ff69b,!0x0),this[_0x232d('0x47')][_0x232d('0x12')]=-_0x4ff69b[_0x232d('0x9d')]+this['_offset'],this[_0x232d('0x48')](_0x4ff69b);}this[_0x232d('0xc5')][_0x232d('0xb7')][_0x232d('0x12')]=_0x401593,_0x40c69c=this[_0x232d('0x79')](_0x7e9c11['data'],_0x7e9c11[_0x232d('0xa4')]),await this[_0x232d('0x1c')](_0x40c69c),this[_0x232d('0x3')](_0x40c69c,_0x1fa500);}_0x7e9c11['lastOperationId']&&(this[_0x232d('0x5e')][_0x232d('0xa3')](_0x40c69c,_0x7e9c11[_0x232d('0x1d')]),this[_0x232d('0x18')]=_0x7e9c11['lastOperationId']),this[_0x232d('0x47')][_0x232d('0x12')]=_0x401593+this[_0x232d('0x5f')],this[_0x232d('0x48')](_0x40c69c);}[_0x232d('0xb3')](_0x429505,_0x274f81){throw this[_0x232d('0x52')]=!0x0,_0x274f81&&console[_0x232d('0x64')](_0x274f81),new _0x16b250(_0x429505,this['editor']);}['_saveOperationInBuffer'](_0x39650b){this[_0x232d('0x92')][_0x232d('0x56')](_0x39650b)||(this[_0x232d('0x92')]['add'](_0x39650b),this[_0x232d('0x7')][_0x232d('0x34')](_0x39650b),this[_0x232d('0x32')]||_0x232d('0xc3')==_0x39650b['type']&&!_0x39650b['affectsData']||this['_setPendingAction']());}[_0x232d('0x3f')](_0x1b425a=!0x1){!_0x1b425a&&this[_0x232d('0x52')]||(this[_0x232d('0x52')]=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this[_0x232d('0x85')]=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0xc4b422=>{_0xc4b422&&(this[_0x232d('0x28')](),this[_0x232d('0x52')]=!0x1);})[_0x232d('0xb4')](_0x170837=>{if(this[_0x232d('0x28')](),this[_0x232d('0x52')]=!0x1,!function(_0xf2c8c4){return _0xf2c8c4[_0x232d('0x8f')][_0x232d('0x3d')]('cloud-services-internal-error:\x20Not\x20connected.')||_0xf2c8c4[_0x232d('0x8f')]['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0xf2c8c4[_0x232d('0x8f')]['startsWith'](_0x232d('0xbe'));}(_0x170837))throw _0x170837;});},this['_currentBufferDelay']));}async[_0x232d('0x5')](){const _0x3fea5a=this[_0x232d('0x36')][_0x232d('0x6')]['get'](_0x53ba97);if(this[_0x232d('0xb8')]()&&(_0x3fea5a[_0x232d('0x9a')](),this[_0x232d('0x2')]=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x430598=[...this[_0x232d('0x7')]];for(const _0x1dc3a4 of _0x430598)_0x1dc3a4[_0x232d('0x30')]=this[_0x232d('0xc5')][_0x232d('0xb7')][_0x232d('0x90')](_0x1dc3a4);const _0x57e850=this[_0x232d('0x5e')]['getIdOfTheLastOperation'](_0x430598),_0x583a79=G++,_0x28d887=this['_compressOperations'](_0x430598),_0x1a54c5=await this[_0x232d('0x58')][_0x232d('0x60')](_0x28d887,_0x28d887[_0x232d('0x76')],_0x57e850);try{return await this[_0x232d('0xa8')](_0x430598,_0x1a54c5,_0x583a79);}catch(_0x12a493){return this[_0x232d('0xb3')](_0x232d('0x46'),_0x12a493);}}async[_0x232d('0xa8')](_0xb375de,_0x568bdb,_0x267c3e){if(_0x568bdb[_0x232d('0x64')])throw _0x568bdb[_0x232d('0x64')];let _0x5e9396=!0x1;if(_0x568bdb[_0x232d('0x87')]){_0x568bdb[_0x232d('0x1d')]&&(this['_lastSyncedOperationId']=_0x568bdb[_0x232d('0x1d')]),this[_0x232d('0x7')]=this[_0x232d('0x7')][_0x232d('0xe')](_0x3434a6=>!_0xb375de['includes'](_0x3434a6));for(const _0x56a9a7 of _0xb375de)_0x56a9a7[_0x232d('0x99')]=_0x568bdb['lastOperationAcceptedAt'];this[_0x232d('0x48')](_0xb375de),_0x5e9396=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];}else{const _0x4b48b5=this[_0x232d('0x79')](_0x568bdb[_0x232d('0x73')],_0x568bdb[_0x232d('0xa4')])[_0x232d('0xe')](_0x18dfee=>_0x18dfee[_0x232d('0x76')]>=this[_0x232d('0x2d')]);await this[_0x232d('0x1c')](_0x4b48b5),_0x5e9396=this[_0x232d('0x6e')](_0x4b48b5,_0x568bdb[_0x232d('0x12')],_0x568bdb[_0x232d('0x1d')]),this['_currentBufferDelay']=Math[_0x232d('0xaa')](this[_0x232d('0x61')]/0x2);}return _0x5e9396?!this['_shouldSendUpdate']()||(this[_0x232d('0x3f')](!0x0),!0x1):this[_0x232d('0xb3')](_0x232d('0xad'));}['_handleExternalOperations'](_0x1c11f1,_0x5bffa2,_0x231ff2){try{const _0x50f08c={'document':this[_0x232d('0xc5')],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x6797b4,operationsB:_0xa85155,originalOperations:_0x4988fe}=_0x37a4ac(_0x1c11f1,this['_bufferedOperations'],_0x50f08c);J(_0x6797b4,this[_0x232d('0xc5')][_0x232d('0x12')]),J(_0xa85155,_0x5bffa2);for(const _0x46a74a of _0x6797b4){const _0x19e6a4=_0x4988fe[_0x232d('0x13')](_0x46a74a);_0x46a74a[_0x232d('0x59')]=_0x19e6a4?_0x19e6a4[_0x232d('0x59')]:null;}_0x231ff2&&(this[_0x232d('0x5e')][_0x232d('0xa3')](_0x1c11f1,_0x231ff2),this[_0x232d('0x18')]=_0x231ff2),this[_0x232d('0x7')]=[..._0xa85155],this[_0x232d('0x3')](_0x6797b4),this['_updateServerHistory'](_0x1c11f1);}catch(_0x2f62c6){return console['error'](_0x2f62c6),!0x1;}return!0x0;}[_0x232d('0x3')](_0x44d8cb,_0x6b6b6d=!0x1){this[_0x232d('0x36')][_0x232d('0x4f')][_0x232d('0xa')]({'isUndoable':!0x1,'isLocal':!0x1},_0x251a7e=>{for(const _0x183c84 of _0x44d8cb)this['_knownOperations'][_0x232d('0x98')](_0x183c84),_0x251a7e[_0x232d('0x22')][_0x232d('0x19')](_0x183c84),this[_0x232d('0x36')]['model'][_0x232d('0xa5')](_0x183c84);});}[_0x232d('0x48')](_0x4e83c1){_0x4e83c1[_0x232d('0xbb')](_0x4beb75=>{const _0x5e6ab0=_0x4beb75['clone']();_0x5e6ab0['_authorId']=_0x4beb75['_authorId'],_0x5e6ab0[_0x232d('0x16')]=!!_0x4beb75[_0x232d('0x16')],_0x5e6ab0[_0x232d('0x99')]=_0x4beb75['createdAt'],_0x5e6ab0[_0x232d('0x76')]+=this[_0x232d('0x5f')],_0x4beb75[_0x232d('0x4')]&&this[_0x232d('0x1f')][_0x232d('0x98')](_0x5e6ab0),this[_0x232d('0x47')][_0x232d('0x19')](_0x5e6ab0);});}[_0x232d('0x54')](_0x3308a7){const _0x38fd86=this[_0x232d('0x36')][_0x232d('0x6')][_0x232d('0x13')]('Notification'),_0x519cb9=this['editor'][_0x232d('0x2b')];_0x3308a7||(_0x3308a7=_0x51195c(_0x519cb9,_0x232d('0x3a'))),_0x38fd86[_0x232d('0x83')](_0x3308a7,{'title':_0x51195c(_0x519cb9,_0x232d('0xf')),'namespace':_0x232d('0x31')}),this[_0x232d('0x81')]=!0x0,clearTimeout(this[_0x232d('0x85')]),this[_0x232d('0x7')]=[],this['editor'][_0x232d('0x6')][_0x232d('0x13')](_0xea8865)[_0x232d('0x57')]();}[_0x232d('0x25')](){this[_0x232d('0x32')]||(this[_0x232d('0x32')]=this['editor'][_0x232d('0x6')][_0x232d('0x13')](_0x18d1d0)['add'](_0x51195c(this['editor'][_0x232d('0x2b')],'PENDING_ACTION_SENDING_DATA')));}['_clearPendingAction'](){this[_0x232d('0x32')]&&(this['editor']['plugins'][_0x232d('0x13')](_0x18d1d0)[_0x232d('0x7d')](this[_0x232d('0x32')]),this[_0x232d('0x32')]=null);}[_0x232d('0x39')](_0x43cbc2){const _0x32ae68=_0x43cbc2[_0x232d('0x62')](_0x24d0c1=>_0x24d0c1[_0x232d('0x0')]());return this[_0x232d('0x4d')][_0x232d('0x50')](_0x32ae68);}[_0x232d('0x79')](_0x3a7084,_0x15e8b8){const _0x28f3c7=this[_0x232d('0x4d')][_0x232d('0x66')](_0x3a7084)[_0x232d('0x62')]((_0x29644d,_0x51baff)=>{const _0x304bb7=_0x569651[_0x232d('0x8a')](_0x29644d,this[_0x232d('0xc5')]);return _0x304bb7[_0x232d('0x30')]=_0x29644d['wasUndone'],'cs:removeUser'===_0x15e8b8[_0x51baff]['type']&&(_0x304bb7[_0x232d('0x4')]=!0x0),_0x304bb7;});return this['_assignOperationsMetaData'](_0x28f3c7,_0x15e8b8),_0x28f3c7;}[_0x232d('0x7c')](_0x4dd1de,_0x3518ff){for(let _0x4a649b=0x0;_0x4a649b<_0x4dd1de[_0x232d('0x9d')];_0x4a649b++)_0x232d('0x80')==_0x3518ff[_0x4a649b][_0x232d('0x41')]?(_0x4dd1de[_0x4a649b][_0x232d('0x16')]=!0x0,_0x4dd1de[_0x4a649b][_0x232d('0x59')]=null):(_0x4dd1de[_0x4a649b]['_isInit']=!0x1,_0x4dd1de[_0x4a649b][_0x232d('0x59')]=_0x3518ff[_0x4a649b][_0x232d('0x71')]),_0x4dd1de[_0x4a649b][_0x232d('0x99')]=_0x3518ff[_0x4a649b][_0x232d('0x99')];}[_0x232d('0x20')](){this[_0x232d('0x2')]=!0x0,this[_0x232d('0xb8')]()&&this[_0x232d('0x3f')]();}[_0x232d('0xb8')](){const _0x5c746e=this['editor']['plugins']['get'](_0x387cc9)[_0x232d('0xc4')][_0x232d('0x13')](this[_0x232d('0x72')]);return!this[_0x232d('0x36')][_0x232d('0xc')]&&_0x5c746e&&_0x5c746e['length']>0x1&&this['_hasSelectionChanged'];}[_0x232d('0xba')](){return this[_0x232d('0x7')][_0x232d('0x9d')]>0x0||this[_0x232d('0xb8')]();}}class j extends Error{}function J(_0x21fda1,_0x479d1e){for(const _0x3b04cf of _0x21fda1)_0x3b04cf[_0x232d('0x76')]=_0x479d1e++;}l['CollaborativeEditingService']=_0x59be25;class K{constructor(_0x3848fb){this[_0x232d('0x6a')]=_0x3848fb,this['_operationToId']=new WeakMap();}[_0x232d('0xaf')](_0x3b0e49){let _0x5254bc=_0x3b0e49['length'];for(;_0x5254bc--;){const _0x54f995=_0x3b0e49[_0x5254bc];if(!this[_0x232d('0x6a')][_0x232d('0x56')](_0x54f995)){if(!this[_0x232d('0x2c')]['has'](_0x54f995)){const _0x4d94cf=_0x115524()[_0x232d('0x4b')](0x1,0x12);this[_0x232d('0x2c')][_0x232d('0xb2')](_0x54f995,_0x4d94cf);}return this[_0x232d('0x2c')][_0x232d('0x13')](_0x54f995);}}}[_0x232d('0xa3')](_0x8ebf8e,_0x5dd22e){if(!_0x5dd22e)return;let _0x137324=_0x8ebf8e[_0x232d('0x9d')];for(;_0x137324--;){const _0x2eaa50=_0x8ebf8e[_0x137324];this[_0x232d('0x6a')][_0x232d('0x56')](_0x2eaa50)||this['_operationToId']['set'](_0x2eaa50,_0x5dd22e);}}}