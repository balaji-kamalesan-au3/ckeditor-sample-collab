/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3b12=['catch','message','add','set','getMany','attributes','TrackChangesEditing','getUser','values','TrackChangesService','config','cloud-services-internal-error:\x20Not\x20connected.','_trackChangesService','plugins','_waitForServiceReady','update','state','type','addSuggestionData','requires','_fetchMissingUsersForThreads','find','hasSuggestion','startsWith','off','getSuggestion','addUser','connection','get','originalSuggestionId','delete','open','connect','_bufferedRequests','addToReconnectionStack','editor'];(function(_0x118366,_0x3b126e){const _0x555f12=function(_0x3f1f7b){while(--_0x3f1f7b){_0x118366['push'](_0x118366['shift']());}};_0x555f12(++_0x3b126e);}(_0x3b12,0xad));const _0x555f=function(_0x118366,_0x3b126e){_0x118366=_0x118366-0x0;let _0x555f12=_0x3b12[_0x118366];return _0x555f12;};import{Plugin as _0x3b8cf6}from'ckeditor5/src/core';import _0x1c4ea7 from'@ckeditor/ckeditor-cloud-services-collaboration/src/track-changes/trackchangesservice';import _0x208025 from'../realtimecollaborativeediting/websocketgateway';import _0xf10f9d from'../realtimecollaborativecomments/cloudservicescommentsadapter';import _0x30e649 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import{Users as _0x531246}from'ckeditor5-collaboration/src/collaboration-core';export default class g extends _0x3b8cf6{static get[_0x555f('0x1a')](){return[_0xf10f9d,_0x555f('0xd'),_0x208025];}constructor(_0x24615e){super(_0x24615e),this[_0x555f('0x4')]=new Map();}['init'](){const _0x43457b=this[_0x555f('0x6')][_0x555f('0x14')]['get'](_0x208025),_0x38b7e4=this[_0x555f('0x6')][_0x555f('0x14')]['get'](_0x555f('0xd')),_0x5edebf=this['editor'][_0x555f('0x11')][_0x555f('0x23')]('collaboration.channelId');return this[_0x555f('0x13')]=new g[(_0x555f('0x10'))](_0x5edebf),_0x38b7e4['adapter']={'getSuggestion':async _0x564369=>{await this[_0x555f('0x15')]();const _0x3e4162=await this[_0x555f('0x13')][_0x555f('0x23')](_0x564369)[_0x555f('0x7')](R);return await this[_0x555f('0x1b')]([_0x3e4162]),_0x3e4162;},'addSuggestion':async({id:_0xe74bfc,type:_0x36cfe2,data:_0x404998,originalSuggestionId:_0x3e8704,attributes:_0x4cf49a})=>{await this[_0x555f('0x15')]();const _0x5a0f8a={'id':_0xe74bfc,'type':_0x36cfe2,'data':_0x404998,'originalSuggestionId':_0x3e8704,'attributes':_0x4cf49a},_0x3f6b2a=await this['_trackChangesService'][_0x555f('0x9')](_0xe74bfc,_0x36cfe2,_0x404998,_0x3e8704,_0x4cf49a)[_0x555f('0x7')](_0x599f5d=>{if(it(_0x599f5d))return new Promise(_0x35b103=>{this[_0x555f('0x4')][_0x555f('0xa')](_0xe74bfc,{'resolve':_0x35b103,'suggestionData':_0x5a0f8a});});throw _0x599f5d;});return this[_0x555f('0x4')][_0x555f('0x1')](_0xe74bfc),_0x3f6b2a;},'updateSuggestion':async(_0x210f7c,_0x2abbfa)=>{if(await this[_0x555f('0x15')](),_0x555f('0x2')!==_0x2abbfa[_0x555f('0x17')])return this[_0x555f('0x13')][_0x555f('0x16')](_0x210f7c,_0x2abbfa)['catch'](R);}},this['listenTo'](this[_0x555f('0x13')],'suggestionUpdated',(_0x2099fd,_0x56f7ee)=>{_0x38b7e4['hasSuggestion'](_0x56f7ee['id'])&&(_0x38b7e4[_0x555f('0x20')](_0x56f7ee['id'])[_0x555f('0xc')]=_0x56f7ee[_0x555f('0xc')]);}),this[_0x555f('0x13')][_0x555f('0x3')](_0x43457b[_0x555f('0x22')])['then'](_0x3e99c6=>(_0x43457b[_0x555f('0x5')](this),this['_fetchMissingUsersForThreads'](_0x3e99c6)['then'](()=>{for(const _0x4b10a5 of _0x3e99c6){_0x38b7e4[_0x555f('0x19')](_0x4b10a5)['_saved']=!0x0;}})));}async['reconnect'](){const _0x5786a9=this['editor'][_0x555f('0x14')][_0x555f('0x23')](_0x555f('0xd')),{connection:_0x4069f1}=this[_0x555f('0x6')][_0x555f('0x14')][_0x555f('0x23')](_0x208025),_0x11bc20=await this[_0x555f('0x13')][_0x555f('0x3')](_0x4069f1);await this[_0x555f('0x1b')](_0x11bc20);for(const {suggestionData:_0x1a61ab,resolve:_0x1693e3}of this[_0x555f('0x4')][_0x555f('0xf')]()){let _0x29cbeb=_0x11bc20[_0x555f('0x1c')](_0x2dc6de=>_0x2dc6de['id']===_0x1a61ab['id']);_0x29cbeb||(_0x29cbeb=await this['_trackChangesService'][_0x555f('0x9')](_0x1a61ab['id'],_0x1a61ab[_0x555f('0x18')],_0x1a61ab['data'],_0x1a61ab[_0x555f('0x0')])),_0x1693e3(_0x29cbeb);}for(const _0x61276d of _0x11bc20)_0x5786a9[_0x555f('0x1d')](_0x61276d['id'])||_0x5786a9['addSuggestionData'](_0x61276d);}async[_0x555f('0x15')](){this['_trackChangesService']['isConnected']||await new Promise(_0x1260fa=>{this['listenTo'](this['_trackChangesService'],'connected',_0x2dfd8d=>{_0x2dfd8d[_0x555f('0x1f')](),_0x1260fa();});});}async[_0x555f('0x1b')](_0x1104d5){const _0x5c97a3=this[_0x555f('0x6')][_0x555f('0x14')]['get'](_0x531246),{connection:_0x5b8a9f}=this['editor'][_0x555f('0x14')][_0x555f('0x23')](_0x208025),_0x3487d9=new Set();for(const {authorId:_0x4e5308}of _0x1104d5)_0x5c97a3['getUser'](_0x4e5308)||_0x3487d9['add'](_0x4e5308);if(0x0===_0x3487d9['size'])return;const _0x361672=await _0x30e649[_0x555f('0xb')](_0x5b8a9f,Array['from'](_0x3487d9));for(const _0x1c0d02 of _0x361672)_0x5c97a3[_0x555f('0xe')](_0x1c0d02['id'])||_0x5c97a3[_0x555f('0x21')](_0x1c0d02);}}function R(_0x3b73ab){if(it(_0x3b73ab))return new Promise(()=>{});throw _0x3b73ab;}function it(_0xfe511d){return _0xfe511d[_0x555f('0x8')][_0x555f('0x1e')](_0x555f('0x12'))||_0xfe511d['message'][_0x555f('0x1e')]('cloud-services-internal-error:\x20Request\x20timeout.');}g[_0x555f('0x10')]=_0x1c4ea7;